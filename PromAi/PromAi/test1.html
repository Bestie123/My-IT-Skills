<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technologies Knowledge Base - Accordion View</title>
    <style>
        /* –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è */
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .auth-section {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #ffeaa7;
        }

        .auth-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }

        .auth-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .auth-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin: 2px;
        }

        button:hover {
            background: #0056b3;
        }

        button.delete {
            background: #dc3545;
        }

        button.delete:hover {
            background: #c82333;
        }

        button.success {
            background: #28a745;
        }

        button.success:hover {
            background: #218838;
        }

        button.warning {
            background: #ffc107;
            color: black;
        }

        button.warning:hover {
            background: #e0a800;
        }

        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px 0;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            border-radius: 5px;
            color: white;
            z-index: 1001;
        }

        .success { background: #28a745; }
        .error { background: #dc3545; }
        .warning { background: #ffc107; color: black; }

        .accordion-container {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
            min-height: 500px;
            overflow: auto;
        }

        .hidden {
            display: none;
        }

        .checklist-section {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .checklist-item:last-child {
            border-bottom: none;
        }

        .checklist-item input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }

        .checklist-item-text {
            flex-grow: 1;
        }

        .checklist-item.completed .checklist-item-text {
            text-decoration: line-through;
            color: #6c757d;
        }

        .checklist-stats {
            margin-top: 10px;
            padding: 8px;
            background: #e9ecef;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .checklist-actions {
            margin-top: 10px;
        }

        .checklist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .checklist-title {
            font-weight: bold;
            font-size: 1.1em;
        }

        button.auto-save-enabled {
            background: #28a745;
        }

        button.auto-save-enabled:hover {
            background: #218838;
        }

        button.auto-save-disabled {
            background: #6c757d;
        }

        button.auto-save-disabled:hover {
            background: #5a6268;
        }

        .auto-save-status {
            display: inline-block;
            margin-left: 10px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }

        .auto-save-on {
            background: #d4edda;
            color: #155724;
        }

        .auto-save-off {
            background: #f8d7da;
            color: #721c24;
        }

        .path-display {
            font-size: 0.8em;
            color: #6c757d;
            margin-left: 10px;
            font-style: italic;
        }

        .parent-select-item {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            background: #f8f9fa;
        }

        .parent-select-item:hover {
            background: #e9ecef;
        }

        .parent-select-item.selected {
            background: #007bff;
            color: white;
            border-color: #0056b3;
        }

        /* –ê–∫–∫–æ—Ä–¥–µ–æ–Ω —Å—Ç–∏–ª–∏ */
        .accordion {
            width: 100%;
        }

        .accordion-item {
            margin-bottom: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }

        .accordion-header {
            padding: 12px 15px;
            background: #f8f9fa;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
            user-select: none;
        }

        .accordion-header:hover {
            background: #e9ecef;
        }

        .accordion-header.category {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
        }

        .accordion-header.technology {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }

        .accordion-title {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-grow: 1;
        }

        .accordion-icon {
            font-size: 1.2em;
        }

        .accordion-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: white;
        }

        .accordion-content.expanded {
            max-height: 5000px;
        }

        .accordion-child {
            margin-left: 30px;
            border-left: 2px solid #e9ecef;
        }

        .accordion-stats {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-right: 10px;
        }

        .accordion-progress {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .accordion-actions {
            display: flex;
            gap: 5px;
        }

        .accordion-toggle {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            padding: 5px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .progress-bar {
            width: 100px;
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin: 5px 0;
        }

        .progress-fill {
            height: 100%;
            background-color: #20c997;
            transition: width 0.3s ease;
        }

        .status-planned { color: #6c757d; }
        .status-in-progress { color: #fd7e14; }
        .status-completed { color: #198754; }

        .checklist-indicator {
            font-size: 0.8em;
            color: #6c757d;
            margin-top: 2px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —á–µ–∫-–ª–∏—Å—Ç–∞ */
        .inline-checklist {
            padding: 15px;
            border-top: 1px solid #e9ecef;
            background: #f8f9fa;
        }

        .inline-checklist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .inline-checklist-title {
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .inline-checklist-toggle {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            padding: 5px;
        }

        .inline-checklist-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .inline-checklist-content.expanded {
            max-height: 1000px;
        }

        .inline-checklist-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .inline-checklist-item:last-child {
            border-bottom: none;
        }

        .inline-checklist-item input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }

        .inline-checklist-item-text {
            flex-grow: 1;
            font-size: 0.9em;
        }

        .inline-checklist-item.completed .inline-checklist-item-text {
            text-decoration: line-through;
            color: #6c757d;
        }

        .inline-checklist-stats {
            padding: 8px;
            background: #e9ecef;
            border-radius: 4px;
            font-size: 0.8em;
            margin-top: 10px;
        }

        .inline-checklist-actions {
            margin-top: 10px;
            display: flex;
            gap: 5px;
        }

        .technology-checkbox {
            margin-left: 10px;
        }

        .technology-checkbox input[type="checkbox"] {
            width: auto;
            margin-right: 5px;
        }

        .sync-status {
            margin-top: 10px;
            padding: 8px;
            background: #e9ecef;
            border-radius: 4px;
            font-size: 0.9em;
            color: #6c757d;
        }

        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –°–ò–°–¢–ï–ú–´ –ó–ù–ê–ù–ò–ô */
        
        /* –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .content-editor {
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
        }

        .editor-toolbar {
            background: #f8f9fa;
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* Code block styling */
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.4;
            overflow-x: auto;
            position: relative;
            border: 1px solid #4a5568;
        }

        .code-block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #4a5568;
        }

        .code-language {
            background: #4a5568;
            color: #a0aec0;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            text-transform: uppercase;
        }

        .code-block-actions {
            display: flex;
            gap: 5px;
        }

        .code-block-actions button {
            background: #4a5568;
            color: #a0aec0;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .code-block-actions button:hover {
            background: #718096;
            color: #e2e8f0;
        }

        .code-content {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Syntax highlighting colors */
        .code-keyword { color: #e53e3e; font-weight: bold; }
        .code-string { color: #38a169; }
        .code-comment { color: #718096; font-style: italic; }
        .code-function { color: #3182ce; }
        .code-variable { color: #d69e2e; }
        .code-number { color: #e53e3e; }
        .code-operator { color: #e2e8f0; }
        .code-class { color: #805ad5; }
        .code-property { color: #38b2ac; }

        /* Context menu styling */
        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            min-width: 150px;
            display: none;
        }

        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .context-menu-item:hover {
            background: #f8f9fa;
        }

        .context-menu-item.disabled {
            color: #6c757d;
            cursor: not-allowed;
        }

        .context-menu-separator {
            border-top: 1px solid #e9ecef;
            margin: 4px 0;
        }

        /* Table of contents styling */
        .toc-container {
            position: fixed;
            right: 20px;
            top: 100px;
            width: 250px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            max-height: 70vh;
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 100;
            display: none;
        }

        .toc-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e9ecef;
        }

        .toc-title {
            font-weight: bold;
            color: #2c3e50;
        }

        .toc-toggle {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            padding: 4px;
        }

        .toc-item {
            margin: 4px 0;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .toc-item:hover {
            background: #f8f9fa;
        }

        .toc-item.toc-h1 {
            font-weight: bold;
            color: #2c3e50;
            margin-left: 0;
        }

        .toc-item.toc-h2 {
            color: #34495e;
            margin-left: 10px;
        }

        .toc-item.toc-h3 {
            color: #7f8c8d;
            margin-left: 20px;
        }

        .toc-item.toc-h4 {
            color: #95a5a6;
            margin-left: 30px;
        }

        /* Bookmark system */
        .bookmark-list {
            margin-top: 10px;
        }

        .bookmark-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            margin: 2px 0;
            background: #fff3cd;
            border-radius: 3px;
            border-left: 3px solid #ffc107;
        }

        .bookmark-item button {
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
            padding: 2px 4px;
        }

        .bookmark-item button:hover {
            color: #dc3545;
        }

        /* Version history */
        .version-history {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            margin-top: 10px;
        }

        .version-item {
            padding: 8px 12px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
        }

        .version-item:hover {
            background: #f8f9fa;
        }

        .version-item:last-child {
            border-bottom: none;
        }

        .version-timestamp {
            color: #6c757d;
            font-size: 0.9em;
        }

        .version-actions {
            float: right;
            font-size: 0.8em;
        }

        /* Breadcrumb navigation */
        .breadcrumb-nav {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .breadcrumb-item {
            display: inline-block;
            color: #007bff;
            cursor: pointer;
        }

        .breadcrumb-item:hover {
            text-decoration: underline;
        }

        .breadcrumb-separator {
            margin: 0 8px;
            color: #6c757d;
        }

        .breadcrumb-current {
            color: #6c757d;
            font-weight: bold;
        }

        /* Enhanced search results */
        .search-result-item {
            padding: 10px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
        }

        .search-result-item:hover {
            background: #f8f9fa;
        }

        .search-result-title {
            font-weight: bold;
            color: #007bff;
        }

        .search-result-context {
            color: #6c757d;
            font-size: 0.9em;
            margin-top: 4px;
        }

        .search-result-path {
            color: #28a745;
            font-size: 0.8em;
            margin-top: 2px;
        }

        /* Mobile responsive improvements */
        @media (max-width: 768px) {
            .toc-container {
                position: static;
                width: 100%;
                margin-top: 20px;
                max-height: 200px;
            }

            .context-menu {
                min-width: 120px;
            }

            .editor-toolbar {
                flex-wrap: wrap;
                gap: 2px;
            }

            .editor-toolbar button {
                padding: 4px 6px;
                font-size: 11px;
                min-width: 28px;
                height: 28px;
            }

            .toolbar-group {
                padding: 0 4px;
            }

            .breadcrumb-nav {
                font-size: 0.8em;
                padding: 6px 8px;
            }
        }

        /* Context menu styling */
        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            min-width: 150px;
            display: none;
        }

        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .context-menu-item:hover {
            background: #f8f9fa;
        }

        .context-menu-item.disabled {
            color: #6c757d;
            cursor: not-allowed;
        }

        .context-menu-separator {
            border-top: 1px solid #e9ecef;
            margin: 4px 0;
        }

        /* Responsive design improvements */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .controls button {
                margin: 2px 0;
            }

            .editor-toolbar {
                padding: 8px;
                gap: 3px;
            }

            .editor-toolbar button {
                padding: 6px 8px;
                font-size: 12px;
                min-width: 28px;
                height: 28px;
            }

            .toolbar-group {
                padding: 0 6px;
            }

            .modal-content {
                margin: 10px;
                width: calc(100vw - 20px);
                max-width: none;
            }

            .accordion-header {
                padding: 10px 12px;
            }

            .accordion-actions {
                flex-direction: column;
                gap: 2px;
            }

            .accordion-actions button {
                font-size: 11px;
                padding: 4px 6px;
            }
        }

        /* Table of contents styling */
        .toc-container {
            position: fixed;
            right: 20px;
            top: 100px;
            width: 250px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            max-height: 70vh;
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 100;
            display: none;
        }

        .toc-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e9ecef;
        }

        .toc-title {
            font-weight: bold;
            color: #2c3e50;
        }

        .toc-toggle {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            padding: 4px;
        }

        .toc-item {
            margin: 4px 0;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .toc-item:hover {
            background: #f8f9fa;
        }

        .toc-item.toc-h1 {
            font-weight: bold;
            color: #2c3e50;
            margin-left: 0;
        }

        .toc-item.toc-h2 {
            color: #34495e;
            margin-left: 10px;
        }

        .toc-item.toc-h3 {
            color: #7f8c8d;
            margin-left: 20px;
        }

        .toc-item.toc-h4 {
            color: #95a5a6;
            margin-left: 30px;
        }

        /* Bookmark system */
        .bookmark-list {
            margin-top: 10px;
        }

        .bookmark-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            margin: 2px 0;
            background: #fff3cd;
            border-radius: 3px;
            border-left: 3px solid #ffc107;
        }

        .bookmark-item button {
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
            padding: 2px 4px;
        }

        .bookmark-item button:hover {
            color: #dc3545;
        }

        /* Version history */
        .version-history {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            margin-top: 10px;
        }

        .version-item {
            padding: 8px 12px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
        }

        .version-item:hover {
            background: #f8f9fa;
        }

        .version-item:last-child {
            border-bottom: none;
        }

        .version-timestamp {
            color: #6c757d;
            font-size: 0.9em;
        }

        .version-actions {
            float: right;
            font-size: 0.8em;
        }

        .toolbar-group {
            display: flex;
            gap: 5px;
            align-items: center;
            padding: 0 8px;
            border-right: 1px solid #ddd;
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .toolbar-separator {
            width: 1px;
            height: 24px;
            background: #ddd;
            margin: 0 4px;
        }

        .editor-toolbar button {
            background: white;
            color: #333;
            border: 1px solid #ddd;
            padding: 6px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            min-width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .editor-toolbar button:hover {
            background: #e9ecef;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .editor-toolbar button:active {
            transform: translateY(0);
        }

        .editor-toolbar button.active {
            background: #007bff;
            color: white;
            border-color: #0056b3;
            box-shadow: 0 2px 4px rgba(0,123,255,0.3);
        }

        .editor-toolbar select {
            background: white;
            border: 1px solid #ddd;
            padding: 5px;
            border-radius: 4px;
            font-size: 13px;
            height: 32px;
            min-width: 80px;
        }

        .editor-toolbar .separator {
            width: 1px;
            height: 24px;
            background: #ddd;
            margin: 0 8px;
        }

        .color-picker {
            width: 32px;
            height: 32px;
            border: 1px solid #ddd;
            cursor: pointer;
            border-radius: 4px;
            position: relative;
        }

        .color-picker:hover {
            border-color: #007bff;
        }

        .color-palette {
            position: absolute;
            top: 35px;
            left: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
            display: none;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .color-palette.show {
            display: grid;
        }

        .color-option {
            width: 20px;
            height: 20px;
            border-radius: 2px;
            cursor: pointer;
            border: 1px solid #ddd;
        }

        .color-option:hover {
            transform: scale(1.2);
        }

        .font-size-select {
            min-width: 60px;
        }

        .heading-select {
            min-width: 100px;
        }

        .table-controls {
            display: none;
            gap: 5px;
            align-items: center;
        }

        .table-controls.show {
            display: flex;
        }

        .find-replace-panel {
            position: absolute;
            top: 45px;
            left: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 320px;
            display: none;
        }

        .find-replace-panel.show {
            display: block;
        }

        .find-replace-panel input {
            width: 100%;
            margin-bottom: 8px;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        .find-replace-panel .buttons {
            display: flex;
            gap: 6px;
            justify-content: flex-end;
        }

        .find-replace-panel button {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 3px;
            background: white;
            cursor: pointer;
        }

        .find-replace-panel button:hover {
            background: #f8f9fa;
        }

        .find-replace-panel button.primary {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .emoji-panel {
            position: absolute;
            top: 45px;
            left: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            max-width: 300px;
            display: none;
            max-height: 200px;
            overflow-y: auto;
        }

        .emoji-panel.show {
            display: block;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 4px;
        }

        .emoji-option {
            padding: 4px;
            cursor: pointer;
            border-radius: 3px;
            text-align: center;
            font-size: 16px;
        }

        .emoji-option:hover {
            background: #f8f9fa;
        }


        
        .editor-content {
            min-height: 300px;
            padding: 15px;
            font-family: Arial, sans-serif;
            line-height: 1.6;
        }
        
        .editor-content:focus {
            outline: none;
        }
        
        /* –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .knowledge-content {
            padding: 15px;
            line-height: 1.6;
        }
        
        .knowledge-content h1, 
        .knowledge-content h2, 
        .knowledge-content h3, 
        .knowledge-content h4 {
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            color: #2c3e50;
        }
        
        .knowledge-content h1 { font-size: 1.8em; border-bottom: 2px solid #3498db; padding-bottom: 5px; }
        .knowledge-content h2 { font-size: 1.5em; border-bottom: 1px solid #bdc3c7; padding-bottom: 3px; }
        .knowledge-content h3 { font-size: 1.3em; }
        .knowledge-content h4 { font-size: 1.1em; }
        
        .knowledge-content p {
            margin-bottom: 1em;
        }
        
        .knowledge-content ul, 
        .knowledge-content ol {
            margin-bottom: 1em;
            padding-left: 2em;
        }
        
        .knowledge-content blockquote {
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin: 1em 0;
            color: #7f8c8d;
            font-style: italic;
        }
        
        .knowledge-content code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .knowledge-content pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 1em 0;
        }
        
        .knowledge-content pre code {
            background: none;
            padding: 0;
            color: inherit;
        }
        
        .knowledge-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
        }
        
        .knowledge-content table, 
        .knowledge-content th, 
        .knowledge-content td {
            border: 1px solid #bdc3c7;
        }
        
        .knowledge-content th, 
        .knowledge-content td {
            padding: 8px 12px;
            text-align: left;
        }
        
        .knowledge-content th {
            background: #f8f9fa;
        }
        
        .knowledge-content img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            margin: 10px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .knowledge-content video {
            max-width: 100%;
            border-radius: 5px;
            margin: 10px 0;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–Ω–æ—Å–æ–∫ */
        .footnote-ref {
            color: #3498db;
            text-decoration: none;
            font-size: 0.8em;
        }

        .footnote-ref:hover {
            text-decoration: underline;
        }

        .footnote {
            margin: 10px 0;
            padding: 8px 12px;
            background: #f8f9fa;
            border-left: 3px solid #3498db;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .footnote-back {
            color: #6c757d;
            text-decoration: none;
            margin-right: 8px;
        }

        .footnote-back:hover {
            color: #3498db;
        }

        .footnotes-separator {
            border: none;
            border-top: 1px solid #e9ecef;
            margin: 20px 0 10px 0;
        }

        .footnotes {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #e9ecef;
        }
        
        .internal-link {
            color: #3498db;
            text-decoration: none;
            border-bottom: 1px dashed #3498db;
            cursor: pointer;
        }

        .internal-link:hover {
            color: #2980b9;
            border-bottom: 1px solid #2980b9;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ */
        .collapsible-section {
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .collapsible-header {
            background: #f8f9fa;
            padding: 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .collapsible-header:hover {
            background: #e9ecef;
        }

        .collapsible-content {
            padding: 15px;
            border-top: 1px solid #eee;
            max-height: none;
            overflow: visible;
        }

        .collapsible-content.collapsed {
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            overflow: hidden;
        }

        .toggle-icon {
            transition: transform 0.3s;
        }

        .collapsible-content.collapsed + .collapsible-header .toggle-icon {
            transform: rotate(-90deg);
        }
        
        .media-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .media-item {
            position: relative;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .media-item img, 
        .media-item video {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .media-item-actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
        }
        
        .media-item-actions button {
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 3px;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∑–Ω–∞–Ω–∏–π */
        .knowledge-modal .modal-content {
            max-width: 95vw;
            max-height: 95vh;
            width: 95vw;
        }

        .editor-content {
            min-height: 400px;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .content-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
        }
        
        .content-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        
        .content-tab.active {
            border-bottom: 2px solid #3498db;
            color: #3498db;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .media-upload-area {
            border: 2px dashed #bdc3c7;
            border-radius: 5px;
            padding: 30px;
            text-align: center;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .media-upload-area:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }
        
        .media-upload-area.dragover {
            border-color: #3498db;
            background: #e3f2fd;
        }
        
        .links-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .link-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .link-item:last-child {
            border-bottom: none;
        }
        
        .search-box {
            margin: 10px 0;
            position: relative;
        }
        
        .search-box input {
            padding-right: 35px;
        }
        
        .search-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }
        
        .knowledge-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .content-preview {
            max-height: 200px;
            overflow: hidden;
            position: relative;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #e9ecef;
            border-radius: 5px;
        }
        
        .content-preview:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(transparent, white);
        }
        
        .knowledge-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: #e3f2fd;
            color: #1976d2;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìö Technologies Knowledge Base - Accordion View</h1>
        
        <!-- –°–µ–∫—Ü–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
        <div class="auth-section" id="authSection">
            <h3>üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ GitHub</h3>
            <div>
                <input type="password" id="githubToken" placeholder="GitHub Personal Access Token" style="width: 300px;">
                <input type="text" id="repoOwner" placeholder="–í–ª–∞–¥–µ–ª–µ—Ü —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è" style="width: 150px;">
                <input type="text" id="repoName" placeholder="–ò–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è" style="width: 150px;">
                <button onclick="authManager.saveAuth()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                <button onclick="authManager.testAuth()" class="success">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
            </div>
            <div id="syncStatus" class="sync-status"></div>
            <div id="authStatus" class="auth-status"></div>
            <p><small>–¢–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ. –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω –≤ GitHub —Å –ø—Ä–∞–≤–∞–º–∏ repo</small></p>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã -->
        <div class="controls">
            <div>
                <button onclick="uiManager.showModal('categoryModal')">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                <button onclick="uiManager.showAddNodeModal()">+ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                <button onclick="uiManager.showAddTechModal()">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é</button>
                <button onclick="authManager.loadFromGitHub()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å GitHub</button>
                <button onclick="authManager.saveToGitHub()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ GitHub</button>
                <button onclick="authManager.forceSync()">üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</button>
                <button onclick="authManager.toggleAutoSave()" id="autoSaveBtn">üö´ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</button>
                <button onclick="dataManager.exportToJSON()">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</button>
                <button onclick="dataManager.importFromJSON()">üì§ –ò–º–ø–æ—Ä—Ç –∏–∑ JSON</button>
                <button onclick="knowledgeManager.showGlobalSearch()" class="success">üîç –ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π</button>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞ -->
        <div id="accordionContainer" class="accordion-container">
            <div id="accordion" class="accordion"></div>
        </div>

        <!-- –°–£–©–ï–°–¢–í–£–Æ–©–ò–ï –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê -->
        <div id="categoryModal" class="modal">
            <div class="modal-content">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                <input type="text" id="newCategoryName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏">
                <div>
                    <button onclick="dataManager.addCategory()">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <button onclick="uiManager.hideModals()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <div id="nodeModal" class="modal">
            <div class="modal-content">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                <div id="nodeParentSelect">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π –≤—ã–±–æ—Ä —Ä–æ–¥–∏—Ç–µ–ª—è -->
                </div>
                <input type="text" id="newNodeName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏">
                <div>
                    <button onclick="dataManager.addNode()">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <button onclick="uiManager.hideModals()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <div id="techModal" class="modal">
            <div class="modal-content">
                <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é</h3>
                <div id="techParentSelect">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π –≤—ã–±–æ—Ä —Ä–æ–¥–∏—Ç–µ–ª—è -->
                </div>
                <input type="text" id="newTechName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏">
                <div>
                    <button onclick="dataManager.addTechnology()">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <button onclick="uiManager.hideModals()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–µ–∫-–ª–∏—Å—Ç–æ–º -->
        <div id="checklistModal" class="modal">
            <div class="modal-content">
                <div class="checklist-header">
                    <h3 id="checklistTitle">–ß–µ–∫-–ª–∏—Å—Ç</h3>
                    <button onclick="uiManager.hideModals()">‚úï</button>
                </div>
                
                <div class="checklist-stats" id="checklistStats">
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
                
                <div id="checklistItems">
                    <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —á–µ–∫-–ª–∏—Å—Ç–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
                
                <div class="checklist-actions">
                    <input type="text" id="newChecklistItem" placeholder="–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç —á–µ–∫-–ª–∏—Å—Ç–∞" style="width: calc(100% - 100px);">
                    <button onclick="checklistManager.addChecklistItem()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
                
                <div style="margin-top: 15px;">
                    <button onclick="checklistManager.saveChecklist()" class="success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ–∫-–ª–∏—Å—Ç</button>
                    <button onclick="uiManager.hideModals()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- –ù–û–í–´–ï –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê –î–õ–Ø –°–ò–°–¢–ï–ú–´ –ó–ù–ê–ù–ò–ô -->
        <div id="knowledgeModal" class="modal knowledge-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="knowledgeTitle">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</h3>
                    <button onclick="uiManager.hideModals()">‚úï</button>
                </div>
                
                <div class="content-tabs">
                    <div class="content-tab active" onclick="knowledgeManager.switchTab('editor')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä</div>
                    <div class="content-tab" onclick="knowledgeManager.switchTab('preview')">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</div>
                    <div class="content-tab" onclick="knowledgeManager.switchTab('media')">üñºÔ∏è –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã</div>
                    <div class="content-tab" onclick="knowledgeManager.switchTab('links')">üîó –°—Å—ã–ª–∫–∏</div>
                </div>
                
                <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
                <div id="editorTab" class="tab-content active">
                    <div class="content-editor">
                        <div class="editor-toolbar">
                            <!-- –ì—Ä—É–ø–ø–∞ 1: –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
                            <div class="toolbar-group">
                                <button onclick="knowledgeEditor.undo()" title="–û—Ç–º–µ–Ω–∏—Ç—å (Ctrl+Z)">‚Ü∂</button>
                                <button onclick="knowledgeEditor.redo()" title="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å (Ctrl+Y)">‚Ü∑</button>
                            </div>
                            <div class="toolbar-separator"></div>

                            <!-- –ì—Ä—É–ø–ø–∞ 2: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ -->
                            <div class="toolbar-group">
                                <select onchange="knowledgeEditor.formatText('fontSize', this.value)" class="font-size-select" title="–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (Ctrl+Shift+>)">
                                    <option value="">–†–∞–∑–º–µ—Ä</option>
                                    <option value="1">8pt</option>
                                    <option value="2">10pt</option>
                                    <option value="3">12pt</option>
                                    <option value="4">14pt</option>
                                    <option value="5">18pt</option>
                                    <option value="6">24pt</option>
                                    <option value="7">36pt</option>
                                </select>
                                <select onchange="knowledgeEditor.formatText('fontName', this.value)" title="–®—Ä–∏—Ñ—Ç">
                                    <option value="">–®—Ä–∏—Ñ—Ç</option>
                                    <option value="Arial">Arial</option>
                                    <option value="Times New Roman">Times New Roman</option>
                                    <option value="Courier New">Courier New</option>
                                    <option value="Georgia">Georgia</option>
                                    <option value="Verdana">Verdana</option>
                                </select>
                            </div>
                            <div class="toolbar-separator"></div>

                            <!-- –ì—Ä—É–ø–ø–∞ 3: –°—Ç–∏–ª–∏ —Ç–µ–∫—Å—Ç–∞ -->
                            <div class="toolbar-group">
                                <button onclick="knowledgeEditor.formatText('bold')" title="–ñ–∏—Ä–Ω—ã–π (Ctrl+B)"><b>B</b></button>
                                <button onclick="knowledgeEditor.formatText('italic')" title="–ö—É—Ä—Å–∏–≤ (Ctrl+I)"><i>I</i></button>
                                <button onclick="knowledgeEditor.formatText('underline')" title="–ü–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ (Ctrl+U)"><u>U</u></button>
                                <button onclick="knowledgeEditor.formatText('strikeThrough')" title="–ó–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ"><s>S</s></button>
                            </div>
                            <div class="toolbar-separator"></div>

                            <!-- –ì—Ä—É–ø–ø–∞ 4: –¶–≤–µ—Ç–∞ –∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ -->
                            <div class="toolbar-group">
                                <div class="color-picker" onclick="knowledgeEditor.showColorPalette('foreColor')" title="–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞">
                                    <div style="width: 20px; height: 20px; background: #000; border-radius: 2px; margin: 4px;"></div>
                                </div>
                                <div class="color-picker" onclick="knowledgeEditor.showColorPalette('backColor')" title="–¶–≤–µ—Ç —Ñ–æ–Ω–∞">
                                    <div style="width: 20px; height: 20px; background: #fff; border: 1px solid #ddd; border-radius: 2px; margin: 4px;"></div>
                                </div>
                                <button onclick="knowledgeEditor.highlightText()" title="–í—ã–¥–µ–ª–∏—Ç—å —Ç–µ–∫—Å—Ç">üñçÔ∏è</button>
                            </div>
                            <div class="toolbar-separator"></div>

                            <!-- –ì—Ä—É–ø–ø–∞ 5: –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ -->
                            <div class="toolbar-group">
                                <button onclick="knowledgeEditor.formatText('justifyLeft')" title="–í—ã—Ä–æ–≤–Ω—è—Ç—å –ø–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é">‚¨ÖÔ∏è</button>
                                <button onclick="knowledgeEditor.formatText('justifyCenter')" title="–í—ã—Ä–æ–≤–Ω—è—Ç—å –ø–æ —Ü–µ–Ω—Ç—Ä—É">‚¨å</button>
                                <button onclick="knowledgeEditor.formatText('justifyRight')" title="–í—ã—Ä–æ–≤–Ω—è—Ç—å –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é">‚û°Ô∏è</button>
                                <button onclick="knowledgeEditor.formatText('justifyFull')" title="–í—ã—Ä–æ–≤–Ω—è—Ç—å –ø–æ —à–∏—Ä–∏–Ω–µ">‚¨å‚¨ÖÔ∏è</button>
                            </div>
                            <div class="toolbar-separator"></div>

                            <!-- –ì—Ä—É–ø–ø–∞ 6: –û—Ç—Å—Ç—É–ø—ã –∏ –∏–Ω–¥–µ–∫—Å—ã -->
                            <div class="toolbar-group">
                                <button onclick="knowledgeEditor.outdent()" title="–£–º–µ–Ω—å—à–∏—Ç—å –æ—Ç—Å—Ç—É–ø">‚Ü∂</button>
                                <button onclick="knowledgeEditor.indent()" title="–£–≤–µ–ª–∏—á–∏—Ç—å –æ—Ç—Å—Ç—É–ø">‚Ü∑</button>
                                <button onclick="knowledgeEditor.formatText('superscript')" title="–ù–∞–¥—Å—Ç—Ä–æ—á–Ω—ã–π">X¬≤</button>
                                <button onclick="knowledgeEditor.formatText('subscript')" title="–ü–æ–¥—Å—Ç—Ä–æ—á–Ω—ã–π">X‚ÇÇ</button>
                            </div>
                            <div class="toolbar-separator"></div>

                            <!-- –ì—Ä—É–ø–ø–∞ 7: –ó–∞–≥–æ–ª–æ–≤–∫–∏ -->
                            <div class="toolbar-group">
                                <select onchange="knowledgeEditor.insertHeading(this.value)" class="heading-select" title="–ó–∞–≥–æ–ª–æ–≤–∫–∏">
                                    <option value="">–ó–∞–≥–æ–ª–æ–≤–æ–∫</option>
                                    <option value="1">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 1</option>
                                    <option value="2">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 2</option>
                                    <option value="3">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 3</option>
                                    <option value="4">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 4</option>
                                    <option value="5">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 5</option>
                                    <option value="6">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 6</option>
                                </select>
                            </div>
                            <div class="toolbar-separator"></div>

                            <!-- –ì—Ä—É–ø–ø–∞ 8: –°–ø–∏—Å–∫–∏ -->
                            <div class="toolbar-group">
                                <button onclick="knowledgeEditor.insertList('ul')" title="–ú–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫">‚Ä¢</button>
                                <button onclick="knowledgeEditor.insertList('ol')" title="–ù—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫">1.</button>
                            </div>
                            <div class="toolbar-separator"></div>

                            <!-- –ì—Ä—É–ø–ø–∞ 9: –ú–µ–¥–∏–∞ –∏ —Å—Å—ã–ª–∫–∏ -->
                            <div class="toolbar-group">
                                <button onclick="knowledgeEditor.insertLink()" title="–í—Å—Ç–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É (Ctrl+K)">üîó</button>
                                <button onclick="knowledgeEditor.insertImage()" title="–í—Å—Ç–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">üñºÔ∏è</button>
                                <button onclick="knowledgeEditor.insertVideo()" title="–í—Å—Ç–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ">üé¨</button>
                                <button onclick="knowledgeEditor.insertTable()" title="–í—Å—Ç–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É">‚ß†</button>
                            </div>
                            <div class="toolbar-separator"></div>

                            <!-- –ì—Ä—É–ø–ø–∞ 10: –ö–æ–¥ –∏ —ç–ª–µ–º–µ–Ω—Ç—ã -->
                            <div class="toolbar-group">
                                <button onclick="knowledgeEditor.insertCodeBlock()" title="–í—Å—Ç–∞–≤–∏—Ç—å –±–ª–æ–∫ –∫–æ–¥–∞ (Ctrl+Shift+C)">{"{}"}</button>
                                <button onclick="knowledgeEditor.insertBlockQuote()" title="–¶–∏—Ç–∞—Ç–∞">"‚ùù</button>
                                <button onclick="knowledgeEditor.insertHorizontalRule()" title="–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å">‚îÅ</button>
                                <button onclick="knowledgeEditor.insertCollapsibleSection()" title="–°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π —Ä–∞–∑–¥–µ–ª">üì¶</button>
                                <button onclick="knowledgeEditor.insertFootnote()" title="–°–Ω–æ—Å–∫–∞">üìù</button>
                            </div>
                            <div class="toolbar-separator"></div>

                            <!-- –ì—Ä—É–ø–ø–∞ 11: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ -->
                            <div class="toolbar-group">
                                <button onclick="knowledgeEditor.showEmojiPanel()" title="–≠–º–æ–¥–∑–∏">üòä</button>
                                <button onclick="knowledgeEditor.showFindReplace()" title="–ù–∞–π—Ç–∏ –∏ –∑–∞–º–µ–Ω–∏—Ç—å (Ctrl+F)">üîç</button>
                                <button onclick="knowledgeEditor.insertInternalLink()" title="–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Å—ã–ª–∫–∞">üìé</button>
                                <button onclick="knowledgeEditor.insertFootnote()" title="–°–Ω–æ—Å–∫–∞">üìù</button>
                                <button onclick="knowledgeEditor.clearFormatting()" title="–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ">üßπ</button>
                            </div>

                            <!-- –ü–∞–Ω–µ–ª—å –ø–æ–∏—Å–∫–∞ –∏ –∑–∞–º–µ–Ω—ã -->
                            <div id="findReplacePanel" class="find-replace-panel">
                                <input type="text" id="findText" placeholder="–ù–∞–π—Ç–∏...">
                                <input type="text" id="replaceText" placeholder="–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞...">
                                <div class="buttons">
                                    <button onclick="knowledgeEditor.findNext()">–ù–∞–π—Ç–∏</button>
                                    <button onclick="knowledgeEditor.replace()">–ó–∞–º–µ–Ω–∏—Ç—å</button>
                                    <button onclick="knowledgeEditor.replaceAll()" class="primary">–ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ</button>
                                    <button onclick="knowledgeEditor.hideFindReplace()">‚úï</button>
                                </div>
                            </div>

                            <!-- –ö–æ–Ω—Ç—Ä–æ–ª—ã —Ç–∞–±–ª–∏—Ü (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏) -->
                            <div id="tableControls" class="table-controls">
                                <div class="toolbar-separator"></div>
                                <button onclick="knowledgeEditor.insertTableRow()" title="–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É">‚ûï‚ÜîÔ∏è</button>
                                <button onclick="knowledgeEditor.deleteTableRow()" title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">‚ûñ‚ÜîÔ∏è</button>
                                <button onclick="knowledgeEditor.insertTableColumn()" title="–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–æ–ª–±–µ—Ü">‚ûï‚ÜïÔ∏è</button>
                                <button onclick="knowledgeEditor.deleteTableColumn()" title="–£–¥–∞–ª–∏—Ç—å —Å—Ç–æ–ª–±–µ—Ü">‚ûñ‚ÜïÔ∏è</button>
                                <button onclick="knowledgeEditor.mergeTableCells()" title="–û–±—ä–µ–¥–∏–Ω–∏—Ç—å —è—á–µ–π–∫–∏">üîó</button>
                                <button onclick="knowledgeEditor.splitTableCell()" title="–†–∞–∑–¥–µ–ª–∏—Ç—å —è—á–µ–π–∫—É">üîÄ</button>
                                <div class="toolbar-separator"></div>
                                <button onclick="knowledgeEditor.alignCellLeft()" title="–í—ã—Ä–æ–≤–Ω—è—Ç—å –ø–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é">‚¨ÖÔ∏è</button>
                                <button onclick="knowledgeEditor.alignCellCenter()" title="–í—ã—Ä–æ–≤–Ω—è—Ç—å –ø–æ —Ü–µ–Ω—Ç—Ä—É">‚¨å</button>
                                <button onclick="knowledgeEditor.alignCellRight()" title="–í—ã—Ä–æ–≤–Ω—è—Ç—å –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é">‚û°Ô∏è</button>
                                <div class="toolbar-separator"></div>
                                <button onclick="knowledgeEditor.showTableProperties()" title="–°–≤–æ–π—Å—Ç–≤–∞ —Ç–∞–±–ª–∏—Ü—ã">‚öôÔ∏è</button>
                            </div>
                        </div>
                        <div id="knowledgeEditor" class="editor-content" contenteditable="true" spellcheck="false"></div>
                    </div>
                </div>
                
                <!-- –í–∫–ª–∞–¥–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
                <div id="previewTab" class="tab-content">
                    <div id="knowledgePreview" class="knowledge-content"></div>
                </div>
                
                <!-- –í–∫–ª–∞–¥–∫–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ -->
                <div id="mediaTab" class="tab-content">
                    <div class="media-upload-area" id="mediaDropZone">
                        üìÅ –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –≤–∏–¥–µ–æ<br>
                        <small>–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤</small>
                        <input type="file" id="mediaUpload" multiple accept="image/*,video/*" style="display: none;">
                    </div>
                    <div id="mediaGallery" class="media-gallery">
                        <!-- –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
                
                <!-- –í–∫–ª–∞–¥–∫–∞ —Å—Å—ã–ª–æ–∫ -->
                <div id="linksTab" class="tab-content">
                    <div class="search-box">
                        <input type="text" id="linkSearch" placeholder="–ü–æ–∏—Å–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π...">
                        <span class="search-icon">üîç</span>
                    </div>
                    <div id="linksList" class="links-panel">
                        <!-- –°–ø–∏—Å–æ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –¥–ª—è —Å—Å—ã–ª–æ–∫ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
                
                <div class="knowledge-actions">
                    <div>
                        <button onclick="knowledgeManager.saveContent()" class="success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button onclick="knowledgeManager.exportContent()">üì• –≠–∫—Å–ø–æ—Ä—Ç</button>
                        <button onclick="knowledgeManager.importContent()">üì§ –ò–º–ø–æ—Ä—Ç</button>
                    </div>
                    <button onclick="uiManager.hideModals()">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π -->
        <div id="searchModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üîç –ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π</h3>
                    <button onclick="uiManager.hideModals()">‚úï</button>
                </div>
                <div class="search-box">
                    <input type="text" id="globalSearch" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å...">
                    <span class="search-icon">üîç</span>
                </div>
                <div id="searchResults" style="max-height: 400px; overflow-y: auto; margin-top: 15px;">
                    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –¥–ª—è JSON -->
        <div id="jsonSection" class="hidden">
            <h3>JSON –¥–∞–Ω–Ω—ã–µ:</h3>
            <textarea id="jsonOutput" style="width: 100%; height: 200px;"></textarea>
            <div>
                <button onclick="dataManager.copyToClipboard()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON</button>
                <button onclick="dataManager.importFromJSONText()">üì§ –ò–º–ø–æ—Ä—Ç –∏–∑ —ç—Ç–æ–≥–æ JSON</button>
                <button onclick="uiManager.hideJSON()">–°–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å—é
        const techData = {
            categories: []
        };

        // –¢–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—É—Ç—å –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        let currentModalPath = [];

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        let lastKnownRemoteSha = null;
        let lastSyncTime = null;

        // –¢–µ–∫—É—â–∏–π —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∑–Ω–∞–Ω–∏–π
        let currentKnowledgeItem = null;

        // === –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –ö–û–î –ê–ö–ö–û–†–î–ï–û–ù–ê ===
        const accordionManager = {
            init() {
                this.accordionContainer = document.getElementById('accordion');
                this.expandedState = JSON.parse(localStorage.getItem('accordionExpandedState')) || {};
                this.checklistExpandedState = JSON.parse(localStorage.getItem('checklistExpandedState')) || {};
                this.renderAccordion();
            },

            renderAccordion() {
                if (!this.accordionContainer) {
                    console.error('Accordion container not found');
                    return;
                }
                
                this.accordionContainer.innerHTML = '';
                
                if (techData.categories.length === 0) {
                    this.accordionContainer.innerHTML = '<p style="text-align: center; color: #6c757d;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é!</p>';
                    return;
                }

                this.buildAccordion(techData.categories, this.accordionContainer, []);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è
                localStorage.setItem('accordionExpandedState', JSON.stringify(this.expandedState));
                localStorage.setItem('checklistExpandedState', JSON.stringify(this.checklistExpandedState));
            },

            buildAccordion(nodes, parentElement, path) {
                nodes.forEach((node, index) => {
                    const currentPath = [...path, index];
                    const pathKey = currentPath.join('-');
                    
                    // –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –∑–∞–¥–∞–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞—Å–∫—Ä—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–æ—Ä–Ω–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                    if (this.expandedState[pathKey] === undefined) {
                        this.expandedState[pathKey] = path.length === 0;
                    }
                    
                    const item = document.createElement('div');
                    item.className = 'accordion-item';
                    
                    // –†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è —É–∑–ª–∞
                    const nodeProgress = this.calculateNodeProgress(node);
                    const progress = nodeProgress.progress;
                    const hasChecklistItems = nodeProgress.hasChecklistItems;
                    
                    let statusText = '';
                    let statusClass = '';
                    
                    if (node.type === 'technology') {
                        if (!hasChecklistItems) {
                            statusText = node.completed ? '‚úÖ –ò–∑—É—á–µ–Ω–æ' : 'üìù –í –ø–ª–∞–Ω–∞—Ö';
                            statusClass = node.completed ? 'status-completed' : 'status-planned';
                        } else {
                            if (progress === 0) {
                                statusText = 'üìù –í –ø–ª–∞–Ω–∞—Ö';
                                statusClass = 'status-planned';
                            } else if (progress === 100) {
                                statusText = '‚úÖ –ò–∑—É—á–µ–Ω–æ';
                                statusClass = 'status-completed';
                            } else {
                                statusText = 'üöß –í –ø—Ä–æ—Ü–µ—Å—Å–µ';
                                statusClass = 'status-in-progress';
                            }
                        }
                    } else {
                        // –î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                        if (progress === 0) {
                            statusText = 'üìù –ù–µ –Ω–∞—á–∞—Ç–æ';
                            statusClass = 'status-planned';
                        } else if (progress === 100) {
                            statusText = '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ';
                            statusClass = 'status-completed';
                        } else {
                            statusText = 'üöß –í –ø—Ä–æ—Ü–µ—Å—Å–µ';
                            statusClass = 'status-in-progress';
                        }
                    }

                    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞
                    const header = document.createElement('div');
                    header.className = `accordion-header ${node.type === 'technology' ? 'technology' : 'category'}`;
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è/—Å–∫—Ä—ã—Ç–∏—è
                    header.onclick = (e) => {
                        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
                        if (!e.target.closest('.accordion-actions') && !e.target.closest('.accordion-toggle') && 
                            !e.target.closest('.technology-checkbox')) {
                            this.toggleItem(pathKey);
                        }
                    };
                    
                    const title = document.createElement('div');
                    title.className = 'accordion-title';
                    
                    // –ò–∫–æ–Ω–∫–∞ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π/—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
                    const icon = document.createElement('span');
                    icon.className = 'accordion-icon';
                    icon.textContent = node.type === 'technology' ? '‚öôÔ∏è' : 'üìÅ';
                    title.appendChild(icon);
                    
                    // –ù–∞–∑–≤–∞–Ω–∏–µ
                    const name = document.createElement('span');
                    name.textContent = node.name;
                    name.style.fontWeight = 'bold';
                    title.appendChild(name);

                    // –ë–µ–π–¥–∂ –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
                    if (node.content && node.content.length > 0) {
                        const badge = document.createElement('span');
                        badge.className = 'knowledge-badge';
                        badge.textContent = 'üìö';
                        badge.title = '–ï—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π';
                        title.appendChild(badge);
                    }
                    
                    header.appendChild(title);
                    
                    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å
                    const stats = document.createElement('div');
                    stats.className = 'accordion-stats';
                    
                    const status = document.createElement('span');
                    status.className = statusClass;
                    status.textContent = statusText;
                    stats.appendChild(status);
                    
                    const progressContainer = document.createElement('div');
                    progressContainer.className = 'accordion-progress';
                    
                    const progressBar = document.createElement('div');
                    progressBar.className = 'progress-bar';
                    progressBar.style.width = '100px';
                    const progressFill = document.createElement('div');
                    progressFill.className = 'progress-fill';
                    progressFill.style.width = `${progress}%`;
                    progressBar.appendChild(progressFill);
                    progressContainer.appendChild(progressBar);
                    
                    const progressText = document.createElement('span');
                    progressText.textContent = `${Math.round(progress)}%`;
                    progressText.style.fontSize = '0.9em';
                    progressText.style.color = '#6c757d';
                    progressContainer.appendChild(progressText);
                    
                    stats.appendChild(progressContainer);
                    
                    // –ß–µ–∫–±–æ–∫—Å –¥–ª—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –±–µ–∑ —á–µ–∫-–ª–∏—Å—Ç–∞
                    if (node.type === 'technology' && (!node.checklist || node.checklist.length === 0)) {
                        const checkboxContainer = document.createElement('div');
                        checkboxContainer.className = 'technology-checkbox';
                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.checked = node.completed || false;
                        checkbox.onchange = (e) => {
                            node.completed = e.target.checked;
                            dataManager.saveToLocalStorage();
                            authManager.scheduleAutoSave();
                            this.renderAccordion();
                        };
                        checkboxContainer.appendChild(checkbox);
                        const label = document.createElement('span');
                        label.textContent = '–ò–∑—É—á–µ–Ω–æ';
                        label.style.fontSize = '0.9em';
                        checkboxContainer.appendChild(label);
                        stats.appendChild(checkboxContainer);
                    }
                    
                    header.appendChild(stats);
                    
                    // –î–µ–π—Å—Ç–≤–∏—è
                    const actions = document.createElement('div');
                    actions.className = 'accordion-actions';
                    
                    if (node.type === 'technology') {
                        actions.innerHTML = `
                            <button onclick="knowledgeManager.openKnowledgeBase('${JSON.stringify(path)}', ${index})" title="–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π" style="background: #9c27b0;">üìö</button>
                            <button onclick="checklistManager.manageChecklist('${JSON.stringify(path)}', ${index})" class="warning" title="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ–∫-–ª–∏—Å—Ç–æ–º">üìã</button>
                            <button onclick="knowledgeManager.showLinkManagementPanel('${JSON.stringify(path)}', ${index})" title="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∞–º–∏" style="background: #2196f3;">üîó</button>
                            <button onclick="dataManager.editTechnology('${JSON.stringify(path)}', ${index})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
                            <button class="delete" onclick="dataManager.deleteTechnology('${JSON.stringify(path)}', ${index})" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                        `;
                    } else {
                        actions.innerHTML = `
                            <button onclick="uiManager.showAddNodeModal('${JSON.stringify(currentPath)}')" title="–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é">+ üìÅ</button>
                            <button onclick="uiManager.showAddTechModal('${JSON.stringify(currentPath)}')" title="–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é">+ ‚öôÔ∏è</button>
                            <button onclick="dataManager.editNode('${JSON.stringify(path)}', ${index})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
                            <button class="delete" onclick="dataManager.deleteNode('${JSON.stringify(path)}', ${index})" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                        `;
                    }
                    
                    header.appendChild(actions);
                    
                    // –ö–Ω–æ–ø–∫–∞ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                    if (node.children && node.children.length > 0) {
                        const toggle = document.createElement('button');
                        toggle.className = 'accordion-toggle';
                        toggle.innerHTML = this.expandedState[pathKey] ? '‚ñº' : '‚ñ∫';
                        toggle.onclick = (e) => {
                            e.stopPropagation();
                            this.toggleItem(pathKey);
                        };
                        header.appendChild(toggle);
                    }
                    
                    item.appendChild(header);
                    
                    // –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞ (–¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã)
                    if (node.children && node.children.length > 0) {
                        const content = document.createElement('div');
                        content.className = 'accordion-content';
                        if (this.expandedState[pathKey]) {
                            content.classList.add('expanded');
                        }
                        
                        const childContainer = document.createElement('div');
                        childContainer.className = 'accordion-child';
                        this.buildAccordion(node.children, childContainer, currentPath);
                        content.appendChild(childContainer);
                        
                        item.appendChild(content);
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π —Å –ø—É–Ω–∫—Ç–∞–º–∏
                    if (node.type === 'technology' && node.checklist && node.checklist.length > 0) {
                        const inlineChecklist = this.createInlineChecklist(node, path, index);
                        item.appendChild(inlineChecklist);
                    }
                    
                    parentElement.appendChild(item);
                });
            },
            
            toggleItem(pathKey) {
                this.expandedState[pathKey] = !this.expandedState[pathKey];
                this.renderAccordion();
            },
            
            createInlineChecklist(tech, path, index) {
                const checklistContainer = document.createElement('div');
                checklistContainer.className = 'inline-checklist';
                
                const checklistKey = path.join('-') + '-' + index;
                const isExpanded = this.checklistExpandedState[checklistKey] !== false; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞—Å–∫—Ä—ã—Ç–æ
                
                const header = document.createElement('div');
                header.className = 'inline-checklist-header';
                
                const title = document.createElement('div');
                title.className = 'inline-checklist-title';
                
                const completedCount = tech.checklist ? tech.checklist.filter(item => item.completed).length : 0;
                const totalCount = tech.checklist ? tech.checklist.length : 0;
                
                title.innerHTML = `
                    <span>üìã –ß–µ–∫-–ª–∏—Å—Ç</span>
                    <span style="font-size: 0.8em; color: #6c757d;">(${completedCount}/${totalCount})</span>
                `;
                
                const toggle = document.createElement('button');
                toggle.className = 'inline-checklist-toggle';
                toggle.innerHTML = isExpanded ? '‚ñº' : '‚ñ∫';
                toggle.onclick = (e) => {
                    e.stopPropagation();
                    this.toggleChecklist(checklistKey);
                };
                
                header.appendChild(title);
                header.appendChild(toggle);
                checklistContainer.appendChild(header);
                
                const content = document.createElement('div');
                content.className = 'inline-checklist-content';
                if (isExpanded) {
                    content.classList.add('expanded');
                }
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                const progress = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;
                
                const stats = document.createElement('div');
                stats.className = 'inline-checklist-stats';
                stats.innerHTML = `
                    –ü—Ä–æ–≥—Ä–µ—Å—Å: ${completedCount}/${totalCount} (${progress}%)
                    <div class="progress-bar" style="width: 100%; margin-top: 5px;">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                `;
                content.appendChild(stats);
                
                // –≠–ª–µ–º–µ–Ω—Ç—ã —á–µ–∫-–ª–∏—Å—Ç–∞
                if (tech.checklist && tech.checklist.length > 0) {
                    tech.checklist.forEach((item, itemIndex) => {
                        const itemElement = document.createElement('div');
                        itemElement.className = `inline-checklist-item ${item.completed ? 'completed' : ''}`;
                        itemElement.innerHTML = `
                            <input type="checkbox" ${item.completed ? 'checked' : ''} 
                                   onchange="checklistManager.toggleChecklistItem('${JSON.stringify(path)}', ${index}, ${itemIndex})">
                            <span class="inline-checklist-item-text">${item.text}</span>
                            <button onclick="checklistManager.editChecklistItemInAccordion('${JSON.stringify(path)}', ${index}, ${itemIndex})" style="margin-left: 5px; padding: 2px 6px; font-size: 0.8em;">‚úèÔ∏è</button>
                            <button onclick="checklistManager.removeChecklistItemInAccordion('${JSON.stringify(path)}', ${index}, ${itemIndex})" class="delete" style="margin-left: 2px; padding: 2px 6px; font-size: 0.8em;">üóëÔ∏è</button>
                        `;
                        content.appendChild(itemElement);
                    });
                }
                
                // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
                const actions = document.createElement('div');
                actions.className = 'inline-checklist-actions';
                actions.innerHTML = `
                    <button onclick="checklistManager.manageChecklist('${JSON.stringify(path)}', ${index})" class="warning" style="font-size: 0.8em; padding: 4px 8px;">üìã –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
                    <button onclick="checklistManager.addChecklistItemInAccordion('${JSON.stringify(path)}', ${index})" style="font-size: 0.8em; padding: 4px 8px;">+ –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç</button>
                `;
                content.appendChild(actions);
                
                checklistContainer.appendChild(content);
                return checklistContainer;
            },
            
            toggleChecklist(checklistKey) {
                this.checklistExpandedState[checklistKey] = !this.checklistExpandedState[checklistKey];
                this.renderAccordion();
            },
            
            // –†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è —É–∑–ª–∞ (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
            calculateNodeProgress(node) {
                if (node.type === 'technology') {
                    // –î–ª—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
                    if (node.checklist && node.checklist.length > 0) {
                        // –ï—Å–ª–∏ –µ—Å—Ç—å —á–µ–∫-–ª–∏—Å—Ç, —Å—á–∏—Ç–∞–µ–º –ø–æ –Ω–µ–º—É
                        const completed = node.checklist.filter(item => item.completed).length;
                        const total = node.checklist.length;
                        const progress = total > 0 ? (completed / total) * 100 : 0;
                        return { progress, hasChecklistItems: true };
                    } else {
                        // –ï—Å–ª–∏ –Ω–µ—Ç —á–µ–∫-–ª–∏—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–µ completed
                        const progress = node.completed ? 100 : 0;
                        return { progress, hasChecklistItems: false };
                    }
                } else {
                    // –î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ - —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Å—á–∏—Ç–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –≤—Å–µ—Ö –¥–µ—Ç–µ–π
                    if (!node.children || node.children.length === 0) {
                        return { progress: 0, hasChecklistItems: false };
                    }
                    
                    let totalProgress = 0;
                    let childCount = 0;
                    let hasChecklistItems = false;
                    
                    node.children.forEach(child => {
                        const childProgress = this.calculateNodeProgress(child);
                        totalProgress += childProgress.progress;
                        childCount++;
                        if (childProgress.hasChecklistItems) {
                            hasChecklistItems = true;
                        }
                    });
                    
                    const progress = childCount > 0 ? totalProgress / childCount : 0;
                    return { progress, hasChecklistItems };
                }
            }
        };

        // === –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –ö–û–î DATA MANAGER ===
        const dataManager = {
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—É—Ç—è–º–∏
            getNodeByPath(path) {
                let currentNode = techData.categories;
                for (const index of path) {
                    if (currentNode[index]) {
                        currentNode = currentNode[index].children || [];
                    } else {
                        return null;
                    }
                }
                return currentNode;
            },

            getNodeAtIndex(path, index) {
                const parent = this.getNodeByPath(path);
                return parent ? parent[index] : null;
            },

            // === –õ–û–ö–ê–õ–¨–ù–û–ï –•–†–ê–ù–ò–õ–ò–©–ï ===
            saveToLocalStorage() {
                localStorage.setItem('techData', JSON.stringify(techData));
            },

            loadFromLocalStorage() {
                const saved = localStorage.getItem('techData');
                if (saved) {
                    try {
                        const parsedData = JSON.parse(saved);
                        techData.categories = parsedData.categories || [];
                        this.renderCurrentView();
                    } catch (e) {
                        console.error('Error parsing saved data:', e);
                    }
                }
            },

            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –≤–∏–¥–∞
            renderCurrentView() {
                accordionManager.renderAccordion();
            },

            // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–ú–ò ===
            addCategory() {
                const name = document.getElementById('newCategoryName').value.trim();
                if (name) {
                    techData.categories.push({
                        name: name,
                        type: 'category',
                        children: []
                    });
                    this.renderCurrentView();
                    this.saveToLocalStorage();
                    uiManager.hideModals();
                    document.getElementById('newCategoryName').value = '';
                    uiManager.showNotification('–ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
                    
                    authManager.scheduleAutoSave();
                } else {
                    uiManager.showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏!', 'error');
                }
            },

            addNode() {
                const name = document.getElementById('newNodeName').value.trim();
                
                if (name && currentModalPath.length >= 0) {
                    const parent = this.getNodeByPath(currentModalPath);
                    if (!parent) {
                        uiManager.showNotification('–û—à–∏–±–∫–∞: —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                        return;
                    }

                    parent.push({
                        name: name,
                        type: 'node',
                        children: []
                    });

                    this.renderCurrentView();
                    this.saveToLocalStorage();
                    uiManager.hideModals();
                    document.getElementById('newNodeName').value = '';
                    uiManager.showNotification('–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
                    
                    authManager.scheduleAutoSave();
                } else {
                    uiManager.showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏!', 'error');
                }
            },

            addTechnology() {
                const name = document.getElementById('newTechName').value.trim();
                
                if (name && currentModalPath.length >= 0) {
                    const parent = this.getNodeByPath(currentModalPath);
                    if (!parent) {
                        uiManager.showNotification('–û—à–∏–±–∫–∞: —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                        return;
                    }

                    const tech = {
                        name: name,
                        type: 'technology',
                        checklist: [],
                        completed: false
                    };

                    parent.push(tech);

                    this.renderCurrentView();
                    this.saveToLocalStorage();
                    uiManager.hideModals();
                    document.getElementById('newTechName').value = '';
                    uiManager.showNotification('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
                    
                    authManager.scheduleAutoSave();
                } else {
                    uiManager.showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏!', 'error');
                }
            },

            // –§—É–Ω–∫—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            editNode(pathStr, index) {
                const path = JSON.parse(pathStr);
                const node = this.getNodeAtIndex(path, index);
                if (!node) return;

                const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:', node.name);
                if (newName && newName.trim()) {
                    node.name = newName.trim();
                    this.renderCurrentView();
                    this.saveToLocalStorage();
                    uiManager.showNotification('–ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞!', 'success');
                    authManager.scheduleAutoSave();
                }
            },

            editTechnology(pathStr, index) {
                const path = JSON.parse(pathStr);
                const node = this.getNodeAtIndex(path, index);
                if (!node) return;

                const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:', node.name);
                if (newName && newName.trim()) {
                    node.name = newName.trim();
                    this.renderCurrentView();
                    this.saveToLocalStorage();
                    uiManager.showNotification('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞!', 'success');
                    authManager.scheduleAutoSave();
                }
            },

            // –§—É–Ω–∫—Ü–∏–∏ —É–¥–∞–ª–µ–Ω–∏—è
            deleteNode(pathStr, index) {
                const path = JSON.parse(pathStr);
                if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –≤—Å–µ –µ—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ?')) {
                    const parent = this.getNodeByPath(path);
                    if (parent) {
                        parent.splice(index, 1);
                        this.renderCurrentView();
                        this.saveToLocalStorage();
                        uiManager.showNotification('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞!', 'success');
                        authManager.scheduleAutoSave();
                    }
                }
            },

            deleteTechnology(pathStr, index) {
                const path = JSON.parse(pathStr);
                if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é –∏ –≤—Å–µ –µ—ë –∑–∞–¥–∞—á–∏?')) {
                    const parent = this.getNodeByPath(path);
                    if (parent) {
                        parent.splice(index, 1);
                        this.renderCurrentView();
                        this.saveToLocalStorage();
                        uiManager.showNotification('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è —É–¥–∞–ª–µ–Ω–∞!', 'success');
                        authManager.scheduleAutoSave();
                    }
                }
            },

            // === –†–ê–ë–û–¢–ê –° JSON ===
            exportToJSON() {
                const jsonOutput = document.getElementById('jsonOutput');
                const jsonSection = document.getElementById('jsonSection');
                
                jsonOutput.value = JSON.stringify(techData, null, 2);
                jsonSection.classList.remove('hidden');
            },

            importFromJSON() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = function(e) {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const parsedData = JSON.parse(e.target.result);
                            techData.categories = parsedData.categories || [];
                            dataManager.renderCurrentView();
                            dataManager.saveToLocalStorage();
                            uiManager.showNotification('–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
                            authManager.scheduleAutoSave();
                        } catch (error) {
                            uiManager.showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ JSON —Ñ–∞–π–ª–∞', 'error');
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            },

            importFromJSONText() {
                const jsonText = document.getElementById('jsonOutput').value;
                try {
                    const parsedData = JSON.parse(jsonText);
                    techData.categories = parsedData.categories || [];
                    this.renderCurrentView();
                    this.saveToLocalStorage();
                    uiManager.showNotification('–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ JSON!', 'success');
                    authManager.scheduleAutoSave();
                } catch (error) {
                    uiManager.showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–±–æ—Ä–µ JSON', 'error');
                }
            },

            copyToClipboard() {
                const jsonOutput = document.getElementById('jsonOutput');
                jsonOutput.select();
                document.execCommand('copy');
                uiManager.showNotification('JSON —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
            }
        };

        // === –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –ö–û–î UI MANAGER ===
        const uiManager = {
            showModal(modalId) {
                document.getElementById(modalId).style.display = 'block';
            },

            showAddNodeModal(pathStr = '[]') {
                const path = JSON.parse(pathStr);
                currentModalPath = path;
                this.updateParentSelect('nodeModal', path);
                this.showModal('nodeModal');
            },

            showAddTechModal(pathStr = '[]') {
                const path = JSON.parse(pathStr);
                currentModalPath = path;
                this.updateParentSelect('techModal', path);
                this.showModal('techModal');
            },

            hideModals() {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            },

            hideJSON() {
                document.getElementById('jsonSection').classList.add('hidden');
            },

            updateParentSelect(modalId, currentPath) {
                const container = document.getElementById(modalId === 'nodeModal' ? 'nodeParentSelect' : 'techParentSelect');
                if (!container) return;
                
                container.innerHTML = '';
                
                const title = document.createElement('div');
                title.innerHTML = `<strong>–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${this.getPathDisplay(currentPath) || '–ö–æ—Ä–µ–Ω—å'}`;
                container.appendChild(title);
            },

            getPathDisplay(path) {
                if (path.length === 0) return '';
                let currentNode = techData.categories;
                let pathNames = [];
                
                for (const index of path) {
                    if (currentNode[index]) {
                        pathNames.push(currentNode[index].name);
                        currentNode = currentNode[index].children || [];
                    }
                }
                
                return pathNames.join(' ‚Üí ');
            },

            showNotification(message, type) {
                const oldNotifications = document.querySelectorAll('.notification');
                oldNotifications.forEach(notif => notif.remove());
                
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        };

        // === –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –ö–û–î CHECKLIST MANAGER ===
        const checklistManager = {
            currentChecklist: {
                path: [],
                techIndex: -1
            },

            // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ß–ï–ö-–õ–ò–°–¢–ê–ú–ò ===
            manageChecklist(pathStr, techIndex) {
                const path = JSON.parse(pathStr);
                this.currentChecklist = {
                    path,
                    techIndex
                };
                
                const tech = this.getTechnology();
                if (!tech) return;
                
                document.getElementById('checklistTitle').textContent = `–ß–µ–∫-–ª–∏—Å—Ç: ${tech.name}`;
                
                if (!tech.checklist) {
                    tech.checklist = [];
                }
                
                this.renderChecklist();
                uiManager.showModal('checklistModal');
            },
            
            renderChecklist() {
                const tech = this.getTechnology();
                if (!tech) return;
                
                const checklistItems = document.getElementById('checklistItems');
                const checklistStats = document.getElementById('checklistStats');
                
                if (!checklistItems || !checklistStats) return;
                
                checklistItems.innerHTML = '';
                
                if (tech.checklist && tech.checklist.length > 0) {
                    tech.checklist.forEach((item, index) => {
                        const itemElement = document.createElement('div');
                        itemElement.className = `checklist-item ${item.completed ? 'completed' : ''}`;
                        itemElement.innerHTML = `
                            <input type="checkbox" ${item.completed ? 'checked' : ''} 
                                   onchange="checklistManager.toggleChecklistItem('${JSON.stringify(this.currentChecklist.path)}', ${this.currentChecklist.techIndex}, ${index})">
                            <span class="checklist-item-text">${item.text}</span>
                            <button onclick="checklistManager.removeChecklistItem(${index})" class="delete" style="margin-left: 10px;">üóëÔ∏è</button>
                            <button onclick="checklistManager.editChecklistItem(${index})" style="margin-left: 5px;">‚úèÔ∏è</button>
                        `;
                        checklistItems.appendChild(itemElement);
                    });
                } else {
                    checklistItems.innerHTML = '<p style="text-align: center; color: #6c757d;">–ß–µ–∫-–ª–∏—Å—Ç –ø—É—Å—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –ø—É–Ω–∫—Ç!</p>';
                }
                
                const completed = tech.checklist ? tech.checklist.filter(item => item.completed).length : 0;
                const total = tech.checklist ? tech.checklist.length : 0;
                const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
                
                checklistStats.innerHTML = `
                    –ü—Ä–æ–≥—Ä–µ—Å—Å: ${completed}/${total} (${progress}%)
                    <div class="progress-bar" style="width: 100%; margin-top: 5px;">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                `;
            },
            
            addChecklistItem() {
                const input = document.getElementById('newChecklistItem');
                if (!input) return;
                
                const text = input.value.trim();
                
                if (text) {
                    const tech = this.getTechnology();
                    if (!tech) return;
                    
                    if (!tech.checklist) {
                        tech.checklist = [];
                    }
                    
                    tech.checklist.push({
                        text: text,
                        completed: false
                    });
                    
                    input.value = '';
                    this.renderChecklist();
                    dataManager.saveToLocalStorage();
                    authManager.scheduleAutoSave();
                    dataManager.renderCurrentView();
                }
            },

            addChecklistItemInAccordion(pathStr, techIndex) {
                const path = JSON.parse(pathStr);
                this.currentChecklist = { path, techIndex };
                const text = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø—É–Ω–∫—Ç —á–µ–∫-–ª–∏—Å—Ç–∞:');
                if (text && text.trim()) {
                    const tech = this.getTechnology();
                    if (!tech) return;
                    
                    if (!tech.checklist) {
                        tech.checklist = [];
                    }
                    
                    tech.checklist.push({
                        text: text.trim(),
                        completed: false
                    });
                    
                    dataManager.saveToLocalStorage();
                    authManager.scheduleAutoSave();
                    dataManager.renderCurrentView();
                }
            },
            
            removeChecklistItem(index) {
                const tech = this.getTechnology();
                if (!tech) return;
                
                if (tech.checklist && tech.checklist.length > index) {
                    tech.checklist.splice(index, 1);
                    this.renderChecklist();
                    dataManager.saveToLocalStorage();
                    authManager.scheduleAutoSave();
                    dataManager.renderCurrentView();
                }
            },

            removeChecklistItemInAccordion(pathStr, techIndex, itemIndex) {
                const path = JSON.parse(pathStr);
                this.currentChecklist = { path, techIndex };
                if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—É–Ω–∫—Ç —á–µ–∫-–ª–∏—Å—Ç–∞?')) {
                    const tech = this.getTechnology();
                    if (!tech) return;
                    
                    if (tech.checklist && tech.checklist.length > itemIndex) {
                        tech.checklist.splice(itemIndex, 1);
                        dataManager.saveToLocalStorage();
                        authManager.scheduleAutoSave();
                        dataManager.renderCurrentView();
                    }
                }
            },
            
            editChecklistItem(index) {
                const tech = this.getTechnology();
                if (!tech) return;
                
                if (tech.checklist && tech.checklist.length > index) {
                    const newText = prompt('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É–Ω–∫—Ç:', tech.checklist[index].text);
                    if (newText !== null) {
                        tech.checklist[index].text = newText.trim();
                        this.renderChecklist();
                        dataManager.saveToLocalStorage();
                        authManager.scheduleAutoSave();
                        dataManager.renderCurrentView();
                    }
                }
            },

            editChecklistItemInAccordion(pathStr, techIndex, itemIndex) {
                const path = JSON.parse(pathStr);
                this.currentChecklist = { path, techIndex };
                const tech = this.getTechnology();
                if (!tech) return;
                
                if (tech.checklist && tech.checklist.length > itemIndex) {
                    const newText = prompt('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É–Ω–∫—Ç:', tech.checklist[itemIndex].text);
                    if (newText !== null) {
                        tech.checklist[itemIndex].text = newText.trim();
                        dataManager.saveToLocalStorage();
                        authManager.scheduleAutoSave();
                        dataManager.renderCurrentView();
                    }
                }
            },
            
            toggleChecklistItem(pathStr, techIndex, itemIndex) {
                const path = JSON.parse(pathStr);
                this.currentChecklist = { path, techIndex };
                const tech = this.getTechnology();
                if (!tech) return;
                
                if (tech.checklist && tech.checklist.length > itemIndex) {
                    tech.checklist[itemIndex].completed = !tech.checklist[itemIndex].completed;
                    dataManager.saveToLocalStorage();
                    authManager.scheduleAutoSave();
                    dataManager.renderCurrentView();
                }
            },
            
            saveChecklist() {
                uiManager.hideModals();
                dataManager.saveToLocalStorage();
                uiManager.showNotification('–ß–µ–∫-–ª–∏—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
                authManager.scheduleAutoSave();
                dataManager.renderCurrentView();
            },
            
            getTechnology() {
                const parent = dataManager.getNodeByPath(this.currentChecklist.path);
                return parent ? parent[this.currentChecklist.techIndex] : null;
            }
        };

        // === –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –ö–û–î AUTH MANAGER ===
        const authManager = {
            autoSaveEnabled: false,
            autoSaveInterval: null,
            lastSaveTime: null,
            autoSaveTimeout: null,

            // === –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø –° –ü–†–û–í–ï–†–ö–û–ô ===
            async testAuth() {
                const token = document.getElementById('githubToken').value;
                const owner = document.getElementById('repoOwner').value;
                const repo = document.getElementById('repoName').value;
                
                if (!token || !owner || !repo) {
                    this.showAuthStatus('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'error');
                    return;
                }

                try {
                    this.showAuthStatus('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...', 'warning');
                    
                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'User-Agent': 'TechDocs-App'
                        }
                    });

                    const responseData = await response.json();

                    if (response.status === 200) {
                        const permissions = responseData.permissions;
                        if (permissions && permissions.push) {
                            this.showAuthStatus('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ! –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏.', 'success');
                            this.enableAutoSave();
                        } else {
                            this.showAuthStatus('‚ö†Ô∏è –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å.', 'warning');
                        }
                    } else if (response.status === 404) {
                        this.showAuthStatus('‚ùå –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è –∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞.', 'error');
                    } else if (response.status === 401) {
                        this.showAuthStatus('‚ùå –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω.', 'error');
                    } else if (response.status === 403) {
                        this.showAuthStatus('üö´ –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ repo.', 'error');
                    } else {
                        this.showAuthStatus(`‚ùå –û—à–∏–±–∫–∞: ${response.status} - ${responseData.message || response.statusText}`, 'error');
                    }
                } catch (error) {
                    console.error('Auth test error:', error);
                    this.showAuthStatus('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message, 'error');
                }
            },

            saveAuth() {
                const token = document.getElementById('githubToken').value;
                const owner = document.getElementById('repoOwner').value;
                const repo = document.getElementById('repoName').value;
                
                if (token && owner && repo) {
                    localStorage.setItem('githubToken', token);
                    localStorage.setItem('repoOwner', owner);
                    localStorage.setItem('repoName', repo);
                    uiManager.showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
                    setTimeout(() => this.testAuth(), 500);
                } else {
                    uiManager.showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'error');
                }
            },

            loadAuth() {
                const token = localStorage.getItem('githubToken');
                const owner = localStorage.getItem('repoOwner');
                const repo = localStorage.getItem('repoName');
                
                if (token) document.getElementById('githubToken').value = token;
                if (owner) document.getElementById('repoOwner').value = owner;
                if (repo) document.getElementById('repoName').value = repo;
                
                if (token && owner && repo) {
                    setTimeout(() => this.testAuth(), 1000);
                }
            },

            showAuthStatus(message, type) {
                const authStatus = document.getElementById('authStatus');
                if (!authStatus) return;
                
                authStatus.textContent = message;
                authStatus.className = 'auth-status';
                authStatus.classList.add(type === 'success' ? 'auth-success' : 
                                       type === 'warning' ? 'auth-warning' : 'auth-error');
                authStatus.style.display = 'block';
            },

            // === –ê–í–¢–û–°–û–•–†–ê–ù–ï–ù–ò–ï –° –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–ï–ú –ü–ï–†–ï–ó–ê–ü–ò–°–ò ===
            enableAutoSave() {
                if (this.autoSaveEnabled) return;
                
                this.autoSaveEnabled = true;
                this.updateAutoSaveButton();
                
                this.autoSaveInterval = setInterval(() => {
                    this.autoSaveToGitHub();
                }, 2 * 60 * 1000);
                
                window.addEventListener('beforeunload', this.autoSaveToGitHub.bind(this));
                
                uiManager.showNotification('üîÑ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ (–∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã)', 'success');
            },
            
            disableAutoSave() {
                if (this.autoSaveInterval) {
                    clearInterval(this.autoSaveInterval);
                    this.autoSaveInterval = null;
                }
                this.autoSaveEnabled = false;
                this.updateAutoSaveButton();
                window.removeEventListener('beforeunload', this.autoSaveToGitHub.bind(this));
                uiManager.showNotification('‚è∏Ô∏è –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ', 'warning');
            },
            
            toggleAutoSave() {
                if (this.autoSaveEnabled) {
                    this.disableAutoSave();
                } else {
                    this.enableAutoSave();
                }
            },
            
            updateAutoSaveButton() {
                const button = document.getElementById('autoSaveBtn');
                if (!button) return;
                
                if (this.autoSaveEnabled) {
                    button.innerHTML = '‚úÖ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ';
                    button.className = 'auto-save-enabled';
                } else {
                    button.innerHTML = 'üö´ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ';
                    button.className = 'auto-save-disabled';
                }
            },
            
            async autoSaveToGitHub() {
                const token = localStorage.getItem('githubToken');
                const owner = localStorage.getItem('repoOwner');
                const repo = localStorage.getItem('repoName');
                
                if (!token || !owner || !repo || !this.autoSaveEnabled) {
                    return;
                }

                const now = Date.now();
                if (this.lastSaveTime && (now - this.lastSaveTime) < 30000) {
                    return;
                }

                try {
                    console.log('üîÑ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ GitHub...');
                    
                    let currentRemoteSha = null;
                    let remoteData = null;
                    
                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–∞ GitHub
                    try {
                        const getResponse = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/tech-data.json`, {
                            headers: {
                                'Authorization': `token ${token}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'User-Agent': 'TechDocs-App'
                            }
                        });
                        
                        if (getResponse.status === 200) {
                            const data = await getResponse.json();
                            currentRemoteSha = data.sha;
                            
                            // –ï—Å–ª–∏ —Ñ–∞–π–ª –∏–∑–º–µ–Ω–∏–ª—Å—è —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
                            if (lastKnownRemoteSha && currentRemoteSha !== lastKnownRemoteSha) {
                                console.log('‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–ª—è —Å–ª–∏—è–Ω–∏—è...');
                                const remoteContent = decodeURIComponent(escape(atob(data.content)));
                                remoteData = JSON.parse(remoteContent);
                                
                                // –°–ª–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
                                this.mergeData(remoteData);
                            }
                            
                            lastKnownRemoteSha = currentRemoteSha;
                        } else if (getResponse.status === 404) {
                            // –§–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                            console.log('üìù –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π');
                        }
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ñ–∞–π–ª–∞ –¥–ª—è –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
                        return;
                    }

                    const content = JSON.stringify(techData, null, 2);
                    const contentBase64 = btoa(unescape(encodeURIComponent(content)));
                    const message = `Auto-save: ${new Date().toLocaleString()}`;
                    
                    const requestBody = {
                        message: message,
                        content: contentBase64
                    };

                    if (currentRemoteSha) {
                        requestBody.sha = currentRemoteSha;
                    }

                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/tech-data.json`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json',
                            'User-Agent': 'TechDocs-App'
                        },
                        body: JSON.stringify(requestBody)
                    });

                    if (response.status === 200 || response.status === 201) {
                        this.lastSaveTime = Date.now();
                        lastSyncTime = Date.now();
                        this.updateSyncStatus();
                        console.log('‚úÖ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ');
                        
                        if (!document.hidden) {
                            this.showAutoSaveNotification();
                        }
                    } else {
                        console.warn('‚ö†Ô∏è –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å:', response.status);
                        
                        // –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ä–∞–∑—Ä–µ—à–∏—Ç—å –µ–≥–æ
                        if (response.status === 409) {
                            this.handleSyncConflict();
                        }
                    }
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                }
            },
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–ª–∏—è–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
            mergeData(remoteData) {
                if (!remoteData || !remoteData.categories) return;
                
                console.log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º —Å–ª–∏—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...');
                
                // –ü—Ä–æ—Å—Ç–æ–µ —Å–ª–∏—è–Ω–∏–µ: –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞
                remoteData.categories.forEach(remoteCategory => {
                    const localCategory = techData.categories.find(cat => cat.name === remoteCategory.name);
                    
                    if (!localCategory) {
                        // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ—Ç –≤ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –¥–æ–±–∞–≤–ª—è–µ–º –µ—ë
                        techData.categories.push(JSON.parse(JSON.stringify(remoteCategory)));
                        console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è: ${remoteCategory.name}`);
                    } else {
                        // –°–ª–∏–≤–∞–µ–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                        this.mergeTechnologies(localCategory, remoteCategory);
                    }
                });
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                dataManager.saveToLocalStorage();
                dataManager.renderCurrentView();
                
                uiManager.showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'success');
            },

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–ª–∏—è–Ω–∏—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
            mergeTechnologies(localCategory, remoteCategory) {
                if (!remoteCategory.children) return;
                
                remoteCategory.children.forEach(remoteItem => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è/–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è
                    const exists = localCategory.children.some(localItem => 
                        localItem.name === remoteItem.name && localItem.type === remoteItem.type
                    );
                    
                    if (!exists) {
                        // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç
                        localCategory.children.push(JSON.parse(JSON.stringify(remoteItem)));
                        console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω ${remoteItem.type === 'technology' ? '—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è' : '–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è'}: ${remoteItem.name}`);
                    } else if (remoteItem.type === 'technology') {
                        // –î–ª—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –º–æ–∂–Ω–æ —Ç–∞–∫–∂–µ —Å–ª–∏–≤–∞—Ç—å —á–µ–∫-–ª–∏—Å—Ç—ã
                        this.mergeChecklists(localCategory, remoteItem);
                    }
                });
            },

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–ª–∏—è–Ω–∏—è —á–µ–∫-–ª–∏—Å—Ç–æ–≤
            mergeChecklists(localCategory, remoteTech) {
                const localTech = localCategory.children.find(item => 
                    item.name === remoteTech.name && item.type === 'technology'
                );
                
                if (!localTech || !remoteTech.checklist) return;
                
                if (!localTech.checklist) {
                    localTech.checklist = [];
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø—É–Ω–∫—Ç—ã —á–µ–∫-–ª–∏—Å—Ç–∞
                remoteTech.checklist.forEach(remoteItem => {
                    const exists = localTech.checklist.some(localItem => 
                        localItem.text === remoteItem.text
                    );
                    
                    if (!exists) {
                        localTech.checklist.push(JSON.parse(JSON.stringify(remoteItem)));
                        console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø—É–Ω–∫—Ç —á–µ–∫-–ª–∏—Å—Ç–∞: ${remoteItem.text}`);
                    }
                });
            },

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            handleSyncConflict() {
                if (confirm('–û–±–Ω–∞—Ä—É–∂–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç –≤–µ—Ä—Å–∏–π. –•–æ—Ç–∏—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞ –∏ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å –≤–∞—à–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏?')) {
                    this.loadFromGitHubWithMerge();
                } else {
                    uiManager.showNotification('‚ö†Ô∏è –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ –∏–∑-–∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞', 'warning');
                    this.disableAutoSave();
                }
            },

            // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å GitHub –¥–ª—è —Å–ª–∏—è–Ω–∏—è
            async loadFromGitHubWithMerge() {
                const token = localStorage.getItem('githubToken');
                const owner = localStorage.getItem('repoOwner');
                const repo = localStorage.getItem('repoName');
                
                if (!token || !owner || !repo) {
                    uiManager.showNotification('–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ GitHub!', 'error');
                    return;
                }

                try {
                    uiManager.showNotification('–ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Å–ª–∏—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å GitHub...', 'warning');
                    
                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/tech-data.json`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'User-Agent': 'TechDocs-App'
                        }
                    });

                    if (response.status === 200) {
                        const data = await response.json();
                        const content = decodeURIComponent(escape(atob(data.content)));
                        const remoteData = JSON.parse(content);
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ —Å–ª–∏—è–Ω–∏–µ–º
                        const localDataBackup = JSON.parse(JSON.stringify(techData));
                        
                        // –°–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                        this.mergeData(remoteData);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º SHA
                        lastKnownRemoteSha = data.sha;
                        lastSyncTime = Date.now();
                        this.updateSyncStatus();
                        
                        uiManager.showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã!', 'success');
                        
                        // –í–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ
                        this.enableAutoSave();
                    } else {
                        throw new Error(`GitHub API error: ${response.status}`);
                    }
                } catch (error) {
                    console.error('GitHub load error:', error);
                    uiManager.showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message, 'error');
                }
            },

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            async forceSync() {
                if (confirm('–≠—Ç–æ –∑–∞–≥—Ä—É–∑–∏—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é —Å GitHub –∏ –æ–±—ä–µ–¥–∏–Ω–∏—Ç —Å –≤–∞—à–∏–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                    await this.loadFromGitHubWithMerge();
                }
            },

            showAutoSaveNotification() {
                const notification = document.createElement('div');
                notification.innerHTML = 'üíæ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ';
                notification.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: #28a745;
                    color: white;
                    padding: 8px 12px;
                    border-radius: 4px;
                    font-size: 12px;
                    z-index: 1002;
                    opacity: 0.9;
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 2000);
            },
            
            scheduleAutoSave() {
                if (!this.autoSaveEnabled) return;
                
                if (this.autoSaveTimeout) {
                    clearTimeout(this.autoSaveTimeout);
                }
                
                this.autoSaveTimeout = setTimeout(() => {
                    this.autoSaveToGitHub();
                }, 10000);
            },

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            updateSyncStatus() {
                const syncStatus = document.getElementById('syncStatus');
                if (!syncStatus) return;
                
                if (lastSyncTime) {
                    const lastSync = new Date(lastSyncTime).toLocaleString();
                    syncStatus.innerHTML = `üîÑ –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: ${lastSync}`;
                } else {
                    syncStatus.innerHTML = '‚è≥ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å';
                }
            },

            // === –†–ê–ë–û–¢–ê –° GITHUB API ===
            async loadFromGitHub() {
                const token = localStorage.getItem('githubToken');
                const owner = localStorage.getItem('repoOwner');
                const repo = localStorage.getItem('repoName');
                
                if (!token || !owner || !repo) {
                    uiManager.showNotification('–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ GitHub!', 'error');
                    return;
                }

                try {
                    uiManager.showNotification('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å GitHub...', 'warning');
                    
                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/tech-data.json`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'User-Agent': 'TechDocs-App'
                        }
                    });

                    if (response.status === 200) {
                        const data = await response.json();
                        const content = decodeURIComponent(escape(atob(data.content)));
                        const parsedData = JSON.parse(content);
                        
                        techData.categories = parsedData.categories || [];
                        dataManager.renderCurrentView();
                        dataManager.saveToLocalStorage();
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
                        lastKnownRemoteSha = data.sha;
                        lastSyncTime = Date.now();
                        this.updateSyncStatus();
                        
                        uiManager.showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å GitHub!', 'success');
                    } else if (response.status === 404) {
                        uiManager.showNotification('üìù –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª.', 'warning');
                        techData.categories = [];
                        dataManager.renderCurrentView();
                        dataManager.saveToLocalStorage();
                    } else {
                        const errorData = await response.json();
                        throw new Error(`GitHub API error: ${response.status} - ${errorData.message || response.statusText}`);
                    }
                } catch (error) {
                    console.error('GitHub load error:', error);
                    uiManager.showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message, 'error');
                }
            },

            async saveToGitHub() {
                const token = localStorage.getItem('githubToken');
                const owner = localStorage.getItem('repoOwner');
                const repo = localStorage.getItem('repoName');
                
                if (!token || !owner || !repo) {
                    uiManager.showNotification('–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ GitHub!', 'error');
                    return;
                }

                try {
                    uiManager.showNotification('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ GitHub...', 'warning');
                    
                    if (!techData || techData.categories.length === 0) {
                        uiManager.showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!', 'error');
                        return;
                    }

                    let sha = null;
                    
                    try {
                        const getResponse = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/tech-data.json`, {
                            headers: {
                                'Authorization': `token ${token}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'User-Agent': 'TechDocs-App'
                            }
                        });
                        
                        if (getResponse.status === 200) {
                            const data = await getResponse.json();
                            sha = data.sha;
                        }
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ñ–∞–π–ª–∞:', e);
                    }

                    const content = JSON.stringify(techData, null, 2);
                    const contentBase64 = btoa(unescape(encodeURIComponent(content)));
                    const message = `Update tech data: ${new Date().toLocaleString()}`;
                    
                    const requestBody = {
                        message: message,
                        content: contentBase64
                    };

                    if (sha) {
                        requestBody.sha = sha;
                    }

                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/tech-data.json`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json',
                            'User-Agent': 'TechDocs-App'
                        },
                        body: JSON.stringify(requestBody)
                    });

                    const responseData = await response.json();

                    if (response.status === 200 || response.status === 201) {
                        lastSyncTime = Date.now();
                        this.updateSyncStatus();
                        uiManager.showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –Ω–∞ GitHub!', 'success');
                    } else {
                        let errorMessage = `–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${response.status}`;
                        if (responseData && responseData.message) {
                            errorMessage += ` - ${responseData.message}`;
                            
                            if (responseData.message.includes('bad credentials')) {
                                errorMessage += '\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞';
                            } else if (responseData.message.includes('not found')) {
                                errorMessage += '\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞';
                            } else if (responseData.message.includes('sha')) {
                                errorMessage += '\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–Ω–∞—á–∞–ª–∞, –∑–∞—Ç–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å';
                            }
                        }
                        throw new Error(errorMessage);
                    }
                } catch (error) {
                    console.error('GitHub save error:', error);
                    uiManager.showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message, 'error');
                }
            }
        };

        // === –ù–û–í–´–ô –ö–û–î –î–õ–Ø –°–ò–°–¢–ï–ú–´ –ó–ù–ê–ù–ò–ô ===
        const knowledgeManager = {
            currentItem: null,
            
            // –û—Ç–∫—Ä—ã—Ç–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞
            openKnowledgeBase(pathStr, index) {
                const path = JSON.parse(pathStr);
                const item = dataManager.getNodeAtIndex(path, index);
                
                if (!item) {
                    uiManager.showNotification('–≠–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                    return;
                }
                
                this.currentItem = item;
                currentKnowledgeItem = item;
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–ª–µ content, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                if (!item.content) {
                    item.content = '';
                }
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
                if (!item.media) {
                    item.media = [];
                }
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Å—ã–ª–∫–∏, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
                if (!item.links) {
                    item.links = [];
                }
                
                document.getElementById('knowledgeTitle').textContent = `–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π: ${item.name}`;
                document.getElementById('knowledgeEditor').innerHTML = item.content || '';
                this.renderPreview();
                this.renderMedia();
                this.renderLinks();
                
                uiManager.showModal('knowledgeModal');
            },
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
            switchTab(tabName) {
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
                document.querySelectorAll('.content-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                document.getElementById(`${tabName}Tab`).classList.add('active');
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É –≤–∫–ª–∞–¥–∫–∏
                document.querySelectorAll('.content-tab').forEach(tab => {
                    if (tab.textContent.includes(this.getTabIcon(tabName))) {
                        tab.classList.add('active');
                    }
                });
                
                // –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä, –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é
                if (tabName === 'preview') {
                    this.renderPreview();
                }
            },
            
            getTabIcon(tabName) {
                const icons = {
                    'editor': '‚úèÔ∏è',
                    'preview': 'üëÅÔ∏è',
                    'media': 'üñºÔ∏è',
                    'links': 'üîó'
                };
                return icons[tabName] || '';
            },
            
            // –†–µ–Ω–¥–µ—Ä –ø—Ä–µ–≤—å—é –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            renderPreview() {
                const content = document.getElementById('knowledgeEditor').innerHTML;
                document.getElementById('knowledgePreview').innerHTML = content;
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Å—ã–ª–∫–∏
                this.processInternalLinks();
            },
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Å—ã–ª–æ–∫ –≤ –ø—Ä–µ–≤—å—é
            processInternalLinks() {
                const internalLinks = document.querySelectorAll('.internal-link');
                internalLinks.forEach(link => {
                    link.onclick = (e) => {
                        e.preventDefault();
                        const targetId = link.getAttribute('data-target');
                        this.navigateToInternalLink(targetId);
                    };
                });
            },
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Å—Å—ã–ª–∫–∞–º
            navigateToInternalLink(targetId) {
                const targetTech = this.findTechnologyById(targetId);
                if (targetTech) {
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
                    uiManager.hideModals();

                    // –ù–∞—Ö–æ–¥–∏–º –ø—É—Ç—å –∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –µ—ë –±–∞–∑—É –∑–Ω–∞–Ω–∏–π
                    const path = this.findPathToTechnology(targetTech);
                    if (path) {
                        setTimeout(() => {
                            knowledgeManager.openKnowledgeBase(JSON.stringify(path.path), path.index);
                        }, 100);
                    } else {
                        uiManager.showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø—É—Ç—å –∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏', 'error');
                    }
                } else {
                    uiManager.showNotification(`–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: ${targetId}`, 'error');
                }
            },

            // –ü–æ–∏—Å–∫ –ø—É—Ç–∏ –∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
            findPathToTechnology(targetTech) {
                function findPath(nodes, currentPath = []) {
                    for (let i = 0; i < nodes.length; i++) {
                        const node = nodes[i];
                        if (node.id === targetTech.id) {
                            return { path: currentPath, index: i };
                        }

                        if (node.children) {
                            const result = findPath(node.children, [...currentPath, i]);
                            if (result) return result;
                        }
                    }
                    return null;
                }

                return findPath(techData.categories);
            },
            
            // –†–µ–Ω–¥–µ—Ä –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤
            renderMedia() {
                const gallery = document.getElementById('mediaGallery');
                gallery.innerHTML = '';
                
                if (!this.currentItem.media || this.currentItem.media.length === 0) {
                    gallery.innerHTML = '<p style="text-align: center; color: #6c757d;">–ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>';
                    return;
                }
                
                this.currentItem.media.forEach((media, index) => {
                    const mediaItem = document.createElement('div');
                    mediaItem.className = 'media-item';
                    
                    if (media.type === 'image') {
                        mediaItem.innerHTML = `
                            <img src="${media.data}" alt="${media.name}">
                            <div class="media-item-actions">
                                <button onclick="knowledgeManager.deleteMedia(${index})" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                                <button onclick="knowledgeManager.insertMediaToEditor('${media.data}', '${media.type}')" title="–í—Å—Ç–∞–≤–∏—Ç—å –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä">üìù</button>
                            </div>
                        `;
                    } else if (media.type === 'video') {
                        mediaItem.innerHTML = `
                            <video controls>
                                <source src="${media.data}" type="${media.mimeType}">
                                –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
                            </video>
                            <div class="media-item-actions">
                                <button onclick="knowledgeManager.deleteMedia(${index})" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                                <button onclick="knowledgeManager.insertMediaToEditor('${media.data}', '${media.type}')" title="–í—Å—Ç–∞–≤–∏—Ç—å –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä">üìù</button>
                            </div>
                        `;
                    }
                    
                    gallery.appendChild(mediaItem);
                });
            },
            
            // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ —Å—Å—ã–ª–æ–∫
            renderLinks() {
                const linksList = document.getElementById('linksList');
                linksList.innerHTML = '';
                
                // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–æ–∫
                const allTech = this.getAllTechnologies();
                
                if (allTech.length === 0) {
                    linksList.innerHTML = '<p style="text-align: center; color: #6c757d;">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                    return;
                }
                
                allTech.forEach(tech => {
                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–∫—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç
                    if (tech === this.currentItem) return;
                    
                    const isLinked = this.currentItem.links && 
                                    this.currentItem.links.some(link => link.id === tech.id);
                    
                    const linkItem = document.createElement('div');
                    linkItem.className = 'link-item';
                    linkItem.innerHTML = `
                        <span>${tech.name}</span>
                        <button onclick="knowledgeManager.toggleLink('${tech.id}')" 
                                class="${isLinked ? 'success' : ''}">
                            ${isLinked ? '‚úÖ' : 'üîó'}
                        </button>
                    `;
                    
                    linksList.appendChild(linkItem);
                });
            },
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
            getAllTechnologies() {
                const technologies = [];

                function traverse(nodes) {
                    nodes.forEach(node => {
                        if (node.type === 'technology') {
                            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                            if (!node.id) {
                                node.id = 'tech_' + Math.random().toString(36).substr(2, 9);
                            }
                            technologies.push(node);
                        }

                        if (node.children) {
                            traverse(node.children);
                        }
                    });
                }

                traverse(techData.categories);
                return technologies;
            },

            // –ü–æ–∏—Å–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
            findTechnologyByName(name) {
                const allTech = this.getAllTechnologies();
                return allTech.find(tech => tech.name === name);
            },
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏
            toggleLink(techId) {
                if (!this.currentItem.links) {
                    this.currentItem.links = [];
                }
                
                const existingIndex = this.currentItem.links.findIndex(link => link.id === techId);
                
                if (existingIndex >= 0) {
                    // –£–¥–∞–ª—è–µ–º —Å—Å—ã–ª–∫—É
                    this.currentItem.links.splice(existingIndex, 1);
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É
                    const targetTech = this.findTechnologyById(techId);
                    if (targetTech) {
                        this.currentItem.links.push({
                            id: techId,
                            name: targetTech.name,
                            path: this.getPathToTechnology(targetTech)
                        });
                    }
                }
                
                this.renderLinks();
                this.scheduleSave();
            },
            
            // –ü–æ–∏—Å–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –ø–æ ID —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π ID –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
            findTechnologyById(targetId) {
                function findInNodes(nodes) {
                    for (const node of nodes) {
                        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                        if (!node.id) {
                            node.id = 'tech_' + Math.random().toString(36).substr(2, 9);
                        }

                        if (node.id === targetId) {
                            return node;
                        }

                        if (node.children) {
                            const found = findInNodes(node.children);
                            if (found) return found;
                        }
                    }
                    return null;
                }

                return findInNodes(techData.categories);
            },
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—É—Ç–∏ –∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
            getPathToTechnology(tech) {
                // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—É—Ç—å –∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö
                // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –ø–æ –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏ –Ω–∞–π—Ç–∏ –ø—É—Ç—å
                return [];
            },
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞
            deleteMedia(index) {
                if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–µ–¥–∏–∞—Ñ–∞–π–ª?')) {
                    this.currentItem.media.splice(index, 1);
                    this.renderMedia();
                    this.scheduleSave();
                }
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ –º–µ–¥–∏–∞ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä
            insertMediaToEditor(data, type) {
                let insertHtml = '';
                
                if (type === 'image') {
                    insertHtml = `<img src="${data}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" style="max-width: 100%;">`;
                } else if (type === 'video') {
                    insertHtml = `<video controls style="max-width: 100%;"><source src="${data}"></video>`;
                }
                
                knowledgeEditor.insertHtml(insertHtml);
                this.switchTab('editor');
            },
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            saveContent() {
                if (!this.currentItem) return;
                
                this.currentItem.content = document.getElementById('knowledgeEditor').innerHTML;
                this.scheduleSave();
                uiManager.showNotification('–ö–æ–Ω—Ç–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
            },
            
            // –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            exportContent() {
                const content = this.currentItem.content;
                const blob = new Blob([content], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${this.currentItem.name}.html`;
                a.click();
                URL.revokeObjectURL(url);
            },
            
            // –ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            importContent() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.html,.txt';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        document.getElementById('knowledgeEditor').innerHTML = e.target.result;
                        this.renderPreview();
                        uiManager.showNotification('–ö–æ–Ω—Ç–µ–Ω—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!', 'success');
                    };
                    reader.readAsText(file);
                };
                input.click();
            },
            
            // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫
            showGlobalSearch() {
                uiManager.showModal('searchModal');
                document.getElementById('globalSearch').focus();
            },
            
            // –ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
            performSearch() {
                const query = document.getElementById('globalSearch').value.toLowerCase();
                const results = document.getElementById('searchResults');
                results.innerHTML = '';
                
                if (!query) {
                    results.innerHTML = '<p style="text-align: center; color: #6c757d;">–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</p>';
                    return;
                }
                
                const searchResults = this.searchInKnowledgeBase(query);
                
                if (searchResults.length === 0) {
                    results.innerHTML = '<p style="text-align: center; color: #6c757d;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
                    return;
                }
                
                searchResults.forEach(result => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-result-item';
                    resultItem.style.padding = '10px';
                    resultItem.style.borderBottom = '1px solid #e9ecef';
                    resultItem.style.cursor = 'pointer';
                    
                    resultItem.innerHTML = `
                        <div style="font-weight: bold;">${result.item.name}</div>
                        <div style="font-size: 0.9em; color: #6c757d;">${result.context}</div>
                    `;
                    
                    resultItem.onclick = () => {
                        this.openKnowledgeBase(JSON.stringify(result.path), result.index);
                        uiManager.hideModals();
                    };
                    
                    results.appendChild(resultItem);
                });
            },
            
            // –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
            searchInKnowledgeBase(query) {
                const results = [];
                
                function searchInNodes(nodes, path = []) {
                    nodes.forEach((node, index) => {
                        // –ü–æ–∏—Å–∫ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏
                        if (node.name.toLowerCase().includes(query)) {
                            results.push({
                                item: node,
                                path: [...path],
                                index: index,
                                context: `–ù–∞–∑–≤–∞–Ω–∏–µ: ${node.name}`
                            });
                        }
                        
                        // –ü–æ–∏—Å–∫ –≤ –∫–æ–Ω—Ç–µ–Ω—Ç–µ
                        if (node.content && node.content.toLowerCase().includes(query)) {
                            const contentPreview = node.content.replace(/<[^>]*>/g, '').substring(0, 100) + '...';
                            results.push({
                                item: node,
                                path: [...path],
                                index: index,
                                context: `–ö–æ–Ω—Ç–µ–Ω—Ç: ${contentPreview}`
                            });
                        }
                        
                        // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –≤ –¥–µ—Ç—è—Ö
                        if (node.children) {
                            searchInNodes(node.children, [...path, index]);
                        }
                    });
                }
                
                searchInNodes(techData.categories);
                return results;
            },
            
            // –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            scheduleSave() {
                dataManager.saveToLocalStorage();
                authManager.scheduleAutoSave();
                accordionManager.renderAccordion();
            }
        };

        // –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        const knowledgeEditor = {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã—Ö —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π
            initKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ
                    if (document.activeElement.id !== 'knowledgeEditor' ||
                        !document.getElementById('knowledgeModal').style.display ||
                        document.getElementById('knowledgeModal').style.display === 'none') return;

                    // Ctrl+B - –∂–∏—Ä–Ω—ã–π
                    if (e.ctrlKey && e.key === 'b') {
                        e.preventDefault();
                        this.formatText('bold');
                    }
                    // Ctrl+I - –∫—É—Ä—Å–∏–≤
                    else if (e.ctrlKey && e.key === 'i') {
                        e.preventDefault();
                        this.formatText('italic');
                    }
                    // Ctrl+U - –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ
                    else if (e.ctrlKey && e.key === 'u') {
                        e.preventDefault();
                        this.formatText('underline');
                    }
                    // Ctrl+Z - –æ—Ç–º–µ–Ω–∞
                    else if (e.ctrlKey && e.key === 'z') {
                        e.preventDefault();
                        this.undo();
                    }
                    // Ctrl+Y - –ø–æ–≤—Ç–æ—Ä
                    else if (e.ctrlKey && e.key === 'y') {
                        e.preventDefault();
                        this.redo();
                    }
                    // Ctrl+K - —Å—Å—ã–ª–∫–∞
                    else if (e.ctrlKey && e.key === 'k') {
                        e.preventDefault();
                        this.insertLink();
                    }
                });
            },

            // –û—Ç–º–µ–Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è
            undo() {
                document.execCommand('undo');
                document.getElementById('knowledgeEditor').focus();
            },

            // –ü–æ–≤—Ç–æ—Ä –¥–µ–π—Å—Ç–≤–∏—è
            redo() {
                document.execCommand('redo');
                document.getElementById('knowledgeEditor').focus();
            },

            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
            formatText(command, value = null) {
                document.execCommand(command, false, value);
                document.getElementById('knowledgeEditor').focus();
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
            insertHeading(level) {
                this.formatText('formatBlock', `<h${level}>`);
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ —Å–ø–∏—Å–∫–∞
            insertList(type) {
                this.formatText(type === 'ul' ? 'insertUnorderedList' : 'insertOrderedList');
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ —Å—Å—ã–ª–∫–∏
            insertLink() {
                const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL:');
                if (url) {
                    this.formatText('createLink', url);
                }
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ –∫–æ–¥–∞
            insertCode() {
                const code = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥:');
                if (code) {
                    this.insertHtml(`<pre><code>${code}</code></pre>`);
                }
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
            insertTable() {
                const rows = parseInt(prompt('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫:', '3')) || 3;
                const cols = parseInt(prompt('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤:', '3')) || 3;

                let tableHtml = '<table style="width: 100%; border-collapse: collapse;" class="editable-table">';

                for (let i = 0; i < rows; i++) {
                    tableHtml += '<tr>';
                    for (let j = 0; j < cols; j++) {
                        tableHtml += `<td style="border: 1px solid #ddd; padding: 8px;" contenteditable="true">&nbsp;</td>`;
                    }
                    tableHtml += '</tr>';
                }

                tableHtml += '</table>';
                this.insertHtml(tableHtml);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—ã —Ç–∞–±–ª–∏—Ü
                this.showTableControls();
            },

            // –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—ã —Ç–∞–±–ª–∏—Ü
            showTableControls() {
                const controls = document.getElementById('tableControls');
                if (controls) {
                    controls.classList.add('show');
                }
            },

            // –°–∫—Ä—ã—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—ã —Ç–∞–±–ª–∏—Ü
            hideTableControls() {
                const controls = document.getElementById('tableControls');
                if (controls) {
                    controls.classList.remove('show');
                }
            },

            // –ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å —Å–≤–æ–π—Å—Ç–≤ —Ç–∞–±–ª–∏—Ü—ã
            showTableProperties() {
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const cell = selection.getRangeAt(0).startContainer;
                const table = cell.closest('table');
                if (!table) return;

                // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–≤–æ–π—Å—Ç–≤ —Ç–∞–±–ª–∏—Ü—ã
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 500px;">
                        <div class="modal-header">
                            <h3>–°–≤–æ–π—Å—Ç–≤–∞ —Ç–∞–±–ª–∏—Ü—ã</h3>
                            <button onclick="this.closest('.modal').remove()">‚úï</button>
                        </div>
                        <div style="padding: 20px;">
                            <div style="margin-bottom: 15px;">
                                <label>–®–∏—Ä–∏–Ω–∞ —Ç–∞–±–ª–∏—Ü—ã:</label>
                                <input type="text" id="tableWidth" placeholder="100%" style="width: 100%; margin-top: 5px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label>–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã:</label>
                                <select id="tableAlign" style="width: 100%; margin-top: 5px;">
                                    <option value="">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                                    <option value="left">–ü–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é</option>
                                    <option value="center">–ü–æ —Ü–µ–Ω—Ç—Ä—É</option>
                                    <option value="right">–ü–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label>–û—Ç—Å—Ç—É–ø —è—á–µ–µ–∫ (padding):</label>
                                <input type="number" id="cellPadding" placeholder="8" min="0" max="50" style="width: 100%; margin-top: 5px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —è—á–µ–π–∫–∞–º–∏ (spacing):</label>
                                <input type="number" id="cellSpacing" placeholder="0" min="0" max="50" style="width: 100%; margin-top: 5px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label>–°—Ç–∏–ª—å –≥—Ä–∞–Ω–∏—Ü:</label>
                                <select id="borderStyle" style="width: 100%; margin-top: 5px;">
                                    <option value="solid">–°–ø–ª–æ—à–Ω–∞—è</option>
                                    <option value="dashed">–ü—É–Ω–∫—Ç–∏—Ä–Ω–∞—è</option>
                                    <option value="dotted">–¢–æ—á–µ—á–Ω–∞—è</option>
                                    <option value="double">–î–≤–æ–π–Ω–∞—è</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label>–¢–æ–ª—â–∏–Ω–∞ –≥—Ä–∞–Ω–∏—Ü:</label>
                                <input type="number" id="borderWidth" placeholder="1" min="0" max="10" style="width: 100%; margin-top: 5px;">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label>–¶–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü:</label>
                                <input type="color" id="borderColor" value="#ddd" style="width: 100%; margin-top: 5px;">
                            </div>
                            <div style="text-align: right;">
                                <button onclick="knowledgeEditor.applyTableProperties()" class="success" style="margin-right: 10px;">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                                <button onclick="this.closest('.modal').remove()">–û—Ç–º–µ–Ω–∞</button>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
                modal.style.display = 'block';

                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
                this.populateTableProperties(table);
            },

            // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞ —Ç–∞–±–ª–∏—Ü—ã —Ç–µ–∫—É—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
            populateTableProperties(table) {
                const width = table.style.width || '100%';
                const align = table.style.marginLeft === 'auto' && table.style.marginRight === 'auto' ? 'center' :
                             table.style.float === 'right' ? 'right' : 'left';

                document.getElementById('tableWidth').value = width;
                document.getElementById('tableAlign').value = align;

                // –ü–æ–ª—É—á–∞–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ –∏–∑ –ø–µ—Ä–≤–æ–π —è—á–µ–π–∫–∏ –∫–∞–∫ –æ–±—Ä–∞–∑–µ—Ü
                const firstCell = table.querySelector('td');
                if (firstCell) {
                    const padding = firstCell.style.padding ? parseInt(firstCell.style.padding) : 8;
                    document.getElementById('cellPadding').value = padding;

                    const borderWidth = firstCell.style.borderWidth ? parseInt(firstCell.style.borderWidth) : 1;
                    document.getElementById('borderWidth').value = borderWidth;

                    const borderColor = firstCell.style.borderColor || '#ddd';
                    document.getElementById('borderColor').value = this.rgbToHex(borderColor);

                    const borderStyle = firstCell.style.borderStyle || 'solid';
                    document.getElementById('borderStyle').value = borderStyle;
                }

                // Cell spacing (–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ CSS, –∏—Å–ø–æ–ª—å–∑—É–µ–º border-collapse)
                const borderCollapse = table.style.borderCollapse || 'collapse';
                document.getElementById('cellSpacing').value = borderCollapse === 'separate' ? 2 : 0;
            },

            // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞ —Ç–∞–±–ª–∏—Ü—ã
            applyTableProperties() {
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const cell = selection.getRangeAt(0).startContainer;
                const table = cell.closest('table');
                if (!table) return;

                const width = document.getElementById('tableWidth').value || '100%';
                const align = document.getElementById('tableAlign').value;
                const cellPadding = document.getElementById('cellPadding').value || 8;
                const cellSpacing = document.getElementById('cellSpacing').value || 0;
                const borderStyle = document.getElementById('borderStyle').value || 'solid';
                const borderWidth = document.getElementById('borderWidth').value || 1;
                const borderColor = document.getElementById('borderColor').value || '#ddd';

                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ –∫ —Ç–∞–±–ª–∏—Ü–µ
                table.style.width = width;
                table.style.borderCollapse = cellSpacing > 0 ? 'separate' : 'collapse';
                table.style.borderSpacing = cellSpacing > 0 ? cellSpacing + 'px' : '0';

                // –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
                table.style.float = '';
                table.style.marginLeft = '';
                table.style.marginRight = '';
                if (align === 'center') {
                    table.style.marginLeft = 'auto';
                    table.style.marginRight = 'auto';
                } else if (align === 'right') {
                    table.style.float = 'right';
                }

                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ –∫–æ –≤—Å–µ–º —è—á–µ–π–∫–∞–º
                const cells = table.querySelectorAll('td, th');
                cells.forEach(cell => {
                    cell.style.border = `${borderWidth}px ${borderStyle} ${borderColor}`;
                    cell.style.padding = cellPadding + 'px';
                });

                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                document.querySelector('.modal').remove();

                this.scheduleTableSave();
                uiManager.showNotification('–°–≤–æ–π—Å—Ç–≤–∞ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã', 'success');
            },

            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å RGB –≤ HEX
            rgbToHex(rgb) {
                if (rgb.startsWith('#')) return rgb;
                if (rgb.startsWith('rgb')) {
                    const match = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
                    if (match) {
                        const r = parseInt(match[1]);
                        const g = parseInt(match[2]);
                        const b = parseInt(match[3]);
                        return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
                    }
                }
                return '#ddd';
            },

            // –í—ã—Ä–æ–≤–Ω—è—Ç—å —è—á–µ–π–∫—É –ø–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é
            alignCellLeft() {
                this.alignCell('left');
            },

            // –í—ã—Ä–æ–≤–Ω—è—Ç—å —è—á–µ–π–∫—É –ø–æ —Ü–µ–Ω—Ç—Ä—É
            alignCellCenter() {
                this.alignCell('center');
            },

            // –í—ã—Ä–æ–≤–Ω—è—Ç—å —è—á–µ–π–∫—É –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é
            alignCellRight() {
                this.alignCell('right');
            },

            // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è —è—á–µ–π–∫–∏
            alignCell(alignment) {
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const cell = selection.getRangeAt(0).startContainer;
                const currentCell = cell.closest('td, th');
                if (!currentCell) return;

                currentCell.style.textAlign = alignment;
                this.scheduleTableSave();
            },

            // –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É —Ç–∞–±–ª–∏—Ü—ã
            insertTableRow() {
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const cell = selection.getRangeAt(0).startContainer;
                const row = cell.closest('tr');
                if (!row) return;

                const newRow = row.cloneNode(true);
                // –û—á–∏—â–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
                const cells = newRow.querySelectorAll('td');
                cells.forEach(cell => cell.innerHTML = '&nbsp;');

                row.parentNode.insertBefore(newRow, row.nextSibling);
                this.scheduleTableSave();
            },

            // –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É —Ç–∞–±–ª–∏—Ü—ã
            deleteTableRow() {
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const cell = selection.getRangeAt(0).startContainer;
                const row = cell.closest('tr');
                if (!row) return;

                const table = row.closest('table');
                const rows = table.querySelectorAll('tr');

                // –ù–µ —É–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–æ–∫—É
                if (rows.length <= 1) {
                    uiManager.showNotification('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–æ–∫—É —Ç–∞–±–ª–∏—Ü—ã', 'warning');
                    return;
                }

                row.remove();
                this.scheduleTableSave();
            },

            // –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–æ–ª–±–µ—Ü —Ç–∞–±–ª–∏—Ü—ã
            insertTableColumn() {
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const cell = selection.getRangeAt(0).startContainer;
                const currentCell = cell.closest('td');
                if (!currentCell) return;

                const table = currentCell.closest('table');
                const rows = table.querySelectorAll('tr');
                const cellIndex = Array.from(currentCell.parentNode.children).indexOf(currentCell);

                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    const newCell = document.createElement('td');
                    newCell.style.border = '1px solid #ddd';
                    newCell.style.padding = '8px';
                    newCell.contentEditable = 'true';
                    newCell.innerHTML = '&nbsp;';

                    if (cellIndex < cells.length) {
                        row.insertBefore(newCell, cells[cellIndex + 1]);
                    } else {
                        row.appendChild(newCell);
                    }
                });

                this.scheduleTableSave();
            },

            // –£–¥–∞–ª–∏—Ç—å —Å—Ç–æ–ª–±–µ—Ü —Ç–∞–±–ª–∏—Ü—ã
            deleteTableColumn() {
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const cell = selection.getRangeAt(0).startContainer;
                const currentCell = cell.closest('td');
                if (!currentCell) return;

                const table = currentCell.closest('table');
                const rows = table.querySelectorAll('tr');
                const cellIndex = Array.from(currentCell.parentNode.children).indexOf(currentCell);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü
                const firstRowCells = rows[0].querySelectorAll('td');
                if (firstRowCells.length <= 1) {
                    uiManager.showNotification('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å—Ç–æ–ª–±–µ—Ü —Ç–∞–±–ª–∏—Ü—ã', 'warning');
                    return;
                }

                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells[cellIndex]) {
                        cells[cellIndex].remove();
                    }
                });

                this.scheduleTableSave();
            },

            // –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —è—á–µ–π–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
            mergeTableCells() {
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const cell = selection.getRangeAt(0).startContainer;
                const currentCell = cell.closest('td');
                if (!currentCell) return;

                // –ü–æ–ª—É—á–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ —è—á–µ–π–∫–∏
                const selectedCells = this.getSelectedTableCells();
                if (selectedCells.length < 2) {
                    uiManager.showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —è—á–µ–µ–∫ –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è', 'warning');
                    return;
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —è—á–µ–π–∫–∏ –æ–±—Ä–∞–∑—É—é—Ç –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å
                if (!this.isValidMergeSelection(selectedCells)) {
                    uiManager.showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Å–º–µ–∂–Ω—ã–µ —è—á–µ–π–∫–∏ –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è', 'warning');
                    return;
                }

                // –û–±—ä–µ–¥–∏–Ω—è–µ–º —è—á–µ–π–∫–∏
                this.performCellMerge(selectedCells);
                this.scheduleTableSave();
            },

            // –†–∞–∑–¥–µ–ª–∏—Ç—å —è—á–µ–π–∫—É —Ç–∞–±–ª–∏—Ü—ã
            splitTableCell() {
                const selection = window.getSelection();
                if (!selection.rangeCount) return;

                const cell = selection.getRangeAt(0).startContainer;
                const currentCell = cell.closest('td');
                if (!currentCell) return;

                const colspan = parseInt(currentCell.getAttribute('colspan') || 1);
                const rowspan = parseInt(currentCell.getAttribute('rowspan') || 1);

                if (colspan === 1 && rowspan === 1) {
                    uiManager.showNotification('–≠—Ç–∞ —è—á–µ–π–∫–∞ –Ω–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∞', 'warning');
                    return;
                }

                // –†–∞–∑–¥–µ–ª—è–µ–º —è—á–µ–π–∫—É
                currentCell.removeAttribute('colspan');
                currentCell.removeAttribute('rowspan');

                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —è—á–µ–π–∫–∏
                const row = currentCell.parentNode;
                const cellIndex = Array.from(row.children).indexOf(currentCell);

                // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                const table = row.closest('table');
                let currentRow = row;

                for (let r = 1; r < rowspan; r++) {
                    currentRow = currentRow.nextElementSibling;
                    if (!currentRow) break;

                    for (let c = 0; c < colspan; c++) {
                        const newCell = document.createElement('td');
                        newCell.style.border = '1px solid #ddd';
                        newCell.style.padding = '8px';
                        newCell.contentEditable = 'true';
                        newCell.innerHTML = '&nbsp;';

                        if (cellIndex + c < currentRow.children.length) {
                            currentRow.insertBefore(newCell, currentRow.children[cellIndex + c]);
                        } else {
                            currentRow.appendChild(newCell);
                        }
                    }
                }

                // –î–æ–±–∞–≤–ª—è–µ–º —è—á–µ–π–∫–∏ –≤ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–æ–∫–µ
                for (let c = 1; c < colspan; c++) {
                    const newCell = document.createElement('td');
                    newCell.style.border = '1px solid #ddd';
                    newCell.style.padding = '8px';
                    newCell.contentEditable = 'true';
                    newCell.innerHTML = '&nbsp;';

                    row.insertBefore(newCell, currentCell.nextSibling);
                }

                this.scheduleTableSave();
            },

            // –ü–æ–ª—É—á–∏—Ç—å –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ —è—á–µ–π–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
            getSelectedTableCells() {
                const selection = window.getSelection();
                const cells = [];

                if (selection.rangeCount) {
                    const range = selection.getRangeAt(0);
                    const container = range.commonAncestorContainer;

                    // –ï—Å–ª–∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ —Ç–∞–±–ª–∏—Ü—ã
                    const table = container.nodeType === Node.TEXT_NODE ?
                        container.parentElement.closest('table') :
                        container.closest('table');

                    if (table) {
                        const selectedCells = table.querySelectorAll('td.selected-for-merge');
                        return Array.from(selectedCells);
                    }
                }

                return cells;
            },

            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è
            isValidMergeSelection(cells) {
                if (cells.length < 2) return false;

                // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Å–µ—Ö —è—á–µ–µ–∫
                const positions = cells.map(cell => {
                    const row = cell.parentNode;
                    const table = row.closest('table');
                    const rowIndex = Array.from(table.rows).indexOf(row);
                    const cellIndex = Array.from(row.cells).indexOf(cell);
                    return { row: rowIndex, col: cellIndex };
                });

                // –ù–∞—Ö–æ–¥–∏–º –≥—Ä–∞–Ω–∏—Ü—ã
                const minRow = Math.min(...positions.map(p => p.row));
                const maxRow = Math.max(...positions.map(p => p.row));
                const minCol = Math.min(...positions.map(p => p.col));
                const maxCol = Math.max(...positions.map(p => p.col));

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —è—á–µ–π–∫–∏ –≤ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
                for (let r = minRow; r <= maxRow; r++) {
                    for (let c = minCol; c <= maxCol; c++) {
                        const found = positions.some(p => p.row === r && p.col === c);
                        if (!found) return false;
                    }
                }

                return true;
            },

            // –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —è—á–µ–µ–∫
            performCellMerge(cells) {
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º —è—á–µ–π–∫–∏ –ø–æ –ø–æ–∑–∏—Ü–∏–∏
                cells.sort((a, b) => {
                    const rowA = a.parentNode;
                    const rowB = b.parentNode;
                    const table = rowA.closest('table');
                    const rowIndexA = Array.from(table.rows).indexOf(rowA);
                    const rowIndexB = Array.from(table.rows).indexOf(rowB);

                    if (rowIndexA !== rowIndexB) return rowIndexA - rowIndexB;

                    const cellIndexA = Array.from(rowA.cells).indexOf(a);
                    const cellIndexB = Array.from(rowB.cells).indexOf(b);
                    return cellIndexA - cellIndexB;
                });

                const firstCell = cells[0];
                let combinedContent = '';

                // –°–æ–±–∏—Ä–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤—Å–µ—Ö —è—á–µ–µ–∫
                cells.forEach(cell => {
                    combinedContent += cell.innerHTML + ' ';
                    if (cell !== firstCell) {
                        cell.remove();
                    }
                });

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è
                const positions = cells.map(cell => {
                    const row = cell.parentNode;
                    const table = row.closest('table');
                    const rowIndex = Array.from(table.rows).indexOf(row);
                    const cellIndex = Array.from(row.cells).indexOf(cell);
                    return { row: rowIndex, col: cellIndex };
                });

                const minRow = Math.min(...positions.map(p => p.row));
                const maxRow = Math.max(...positions.map(p => p.row));
                const minCol = Math.min(...positions.map(p => p.col));
                const maxCol = Math.max(...positions.map(p => p.col));

                const rowspan = maxRow - minRow + 1;
                const colspan = maxCol - minCol + 1;

                if (rowspan > 1) firstCell.setAttribute('rowspan', rowspan);
                if (colspan > 1) firstCell.setAttribute('colspan', colspan);

                firstCell.innerHTML = combinedContent.trim();
            },

            // –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
            scheduleTableSave() {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ knowledgeManager
                if (knowledgeManager.currentItem) {
                    knowledgeManager.currentItem.content = document.getElementById('knowledgeEditor').innerHTML;
                    knowledgeManager.scheduleSave();
                }
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            insertImage() {
                const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:');
                if (url) {
                    this.insertHtml(`<img src="${url}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" style="max-width: 100%;">`);
                }
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ –≤–∏–¥–µ–æ
            insertVideo() {
                const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL –≤–∏–¥–µ–æ:');
                if (url) {
                    this.insertHtml(`<video controls style="max-width: 100%;"><source src="${url}"></video>`);
                }
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Å—ã–ª–∫–∏
            insertInternalLink() {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
                knowledgeManager.showInternalLinkDialog();
            },

            // –í—Å—Ç–∞–≤–∫–∞ —Å–Ω–æ—Å–∫–∏
            insertFootnote() {
                const footnoteId = 'footnote_' + Date.now();
                const footnoteText = prompt('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–Ω–æ—Å–∫–∏:');
                if (footnoteText) {
                    const footnoteHtml = `<sup><a href="#${footnoteId}" id="ref_${footnoteId}" class="footnote-ref">[${this.getFootnoteNumber()}]</a></sup>`;
                    const footnoteContent = `<div class="footnote" id="${footnoteId}"><a href="#ref_${footnoteId}" class="footnote-back">‚Üë</a> ${footnoteText}</div>`;

                    this.insertHtml(footnoteHtml);

                    // –î–æ–±–∞–≤–ª—è–µ–º —Å–Ω–æ—Å–∫—É –≤ –∫–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞
                    const editor = document.getElementById('knowledgeEditor');
                    const existingFootnotes = editor.querySelectorAll('.footnote');
                    if (existingFootnotes.length > 0) {
                        existingFootnotes[existingFootnotes.length - 1].insertAdjacentHTML('afterend', footnoteContent);
                    } else {
                        editor.insertAdjacentHTML('beforeend', '<hr class="footnotes-separator"><div class="footnotes">' + footnoteContent + '</div>');
                    }
                }
            },

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Å–Ω–æ—Å–∫–∏
            getFootnoteNumber() {
                const editor = document.getElementById('knowledgeEditor');
                const existingRefs = editor.querySelectorAll('.footnote-ref');
                return existingRefs.length + 1;
            },

            // –í—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
            highlightText() {
                const color = '#ffff00'; // –ñ–µ–ª—Ç—ã–π —Ü–≤–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏—è
                this.formatText('backColor', color);
            },

            // –í—Å—Ç–∞–≤–∫–∞ —Ü–∏—Ç–∞—Ç—ã
            insertBlockQuote() {
                const selection = window.getSelection();
                const selectedText = selection.toString();

                if (selectedText) {
                    const quoteHtml = `<blockquote style="border-left: 4px solid #3498db; padding-left: 15px; margin: 15px 0; color: #555; font-style: italic;">${selectedText}</blockquote>`;
                    this.insertHtml(quoteHtml);
                } else {
                    this.insertHtml(`<blockquote style="border-left: 4px solid #3498db; padding-left: 15px; margin: 15px 0; color: #555; font-style: italic;">–í–≤–µ–¥–∏—Ç–µ —Ü–∏—Ç–∞—Ç—É –∑–¥–µ—Å—å</blockquote>`);
                }
            },

            // –í—Å—Ç–∞–≤–∫–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –ª–∏–Ω–∏–∏
            insertHorizontalRule() {
                this.insertHtml(`<hr style="border: none; border-top: 2px solid #ddd; margin: 20px 0;">`);
            },

            // –í—Å—Ç–∞–≤–∫–∞ —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
            insertCollapsibleSection() {
                const title = prompt('–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–¥–µ–ª–∞:', '–°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–π —Ä–∞–∑–¥–µ–ª');
                if (title) {
                    const sectionHtml = `
                        <div class="collapsible-section" style="margin: 15px 0; border: 1px solid #ddd; border-radius: 5px;">
                            <div class="collapsible-header" onclick="this.nextElementSibling.classList.toggle('collapsed')" style="background: #f8f9fa; padding: 10px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                                <span>${title}</span>
                                <span class="toggle-icon" style="font-size: 1.2em;">‚ñº</span>
                            </div>
                            <div class="collapsible-content" style="padding: 15px;">
                                –í–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–∞–∑–¥–µ–ª–∞ –∑–¥–µ—Å—å
                            </div>
                        </div>
                    `;
                    this.insertHtml(sectionHtml);
                }
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ HTML
            insertHtml(html) {
                const editor = document.getElementById('knowledgeEditor');
                const selection = window.getSelection();
                
                if (selection.rangeCount) {
                    const range = selection.getRangeAt(0);
                    range.deleteContents();
                    
                    const div = document.createElement('div');
                    div.innerHTML = html;
                    const fragment = document.createDocumentFragment();
                    
                    while (div.firstChild) {
                        fragment.appendChild(div.firstChild);
                    }
                    
                    range.insertNode(fragment);
                } else {
                    editor.innerHTML += html;
                }
                
                editor.focus();
            }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–¥–∏–∞
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è drag & drop –¥–ª—è –º–µ–¥–∏–∞
            const dropZone = document.getElementById('mediaDropZone');
            const fileInput = document.getElementById('mediaUpload');
            
            dropZone.addEventListener('click', () => {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', (e) => {
                knowledgeManager.handleFiles(e.target.files);
            });
            
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                knowledgeManager.handleFiles(e.dataTransfer.files);
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞
            document.getElementById('globalSearch').addEventListener('input', () => {
                knowledgeManager.performSearch();
            });
            
            document.getElementById('linkSearch').addEventListener('input', () => {
                knowledgeManager.filterLinks();
            });
        });

        // –†–∞—Å—à–∏—Ä—è–µ–º knowledgeManager –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
        knowledgeManager.handleFiles = function(files) {
            for (const file of files) {
                const reader = new FileReader();

                reader.onload = (e) => {
                    const mediaType = file.type.startsWith('image/') ? 'image' :
                                    file.type.startsWith('video/') ? 'video' : 'other';

                    if (mediaType === 'other') {
                        uiManager.showNotification('–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞', 'error');
                        return;
                    }

                    if (!this.currentItem.media) {
                        this.currentItem.media = [];
                    }

                    this.currentItem.media.push({
                        name: file.name,
                        type: mediaType,
                        data: e.target.result,
                        mimeType: file.type,
                        size: file.size
                    });

                    this.renderMedia();
                    this.scheduleSave();
                    uiManager.showNotification(`–§–∞–π–ª "${file.name}" –∑–∞–≥—Ä—É–∂–µ–Ω`, 'success');
                };

                reader.readAsDataURL(file);
            }
        };

        // –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Å—ã–ª–∫–∞–º–∏
        knowledgeManager.showLinkManagementPanel = function(pathStr, index) {
            const path = JSON.parse(pathStr);
            const item = dataManager.getNodeAtIndex(path, index);

            if (!item) {
                uiManager.showNotification('–≠–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }

            this.currentItem = item;

            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h3>üîó –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∞–º–∏: ${item.name}</h3>
                        <button onclick="this.closest('.modal').remove()">‚úï</button>
                    </div>
                    <div style="padding: 20px;">
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #2196f3; border-bottom: 2px solid #2196f3; padding-bottom: 5px;">üì• –í—Ö–æ–¥—è—â–∏–µ —Å—Å—ã–ª–∫–∏ (—Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç)</h4>
                            <div id="incomingLinks" style="border: 1px solid #e9ecef; border-radius: 4px; padding: 15px; min-height: 60px; background: #f8f9fa;">
                                <!-- –í—Ö–æ–¥—è—â–∏–µ —Å—Å—ã–ª–∫–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                            </div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #4caf50; border-bottom: 2px solid #4caf50; padding-bottom: 5px;">üì§ –ò—Å—Ö–æ–¥—è—â–∏–µ —Å—Å—ã–ª–∫–∏ (—Å—Å—ã–ª–∫–∏ –∏–∑ —ç—Ç–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞)</h4>
                            <div id="outgoingLinks" style="border: 1px solid #e9ecef; border-radius: 4px; padding: 15px; min-height: 60px; background: #f8f9fa;">
                                <!-- –ò—Å—Ö–æ–¥—è—â–∏–µ —Å—Å—ã–ª–∫–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                            </div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #ff9800; border-bottom: 2px solid #ff9800; padding-bottom: 5px;">üîç –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤</h4>
                            <input type="text" id="linkSearchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px;">
                            <div id="relatedItems" style="border: 1px solid #e9ecef; border-radius: 4px; padding: 10px; min-height: 40px; background: #f8f9fa; max-height: 200px; overflow-y: auto;">
                                <!-- –°–≤—è–∑–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                            </div>
                        </div>
                        <div style="text-align: right; border-top: 1px solid #e9ecef; padding-top: 15px;">
                            <button onclick="knowledgeManager.validateLinks()" style="margin-right: 10px; background: #28a745;">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Å—ã–ª–∫–∏</button>
                            <button onclick="knowledgeManager.createLinkReport()" style="margin-right: 10px; background: #17a2b8;">üìä –û—Ç—á–µ—Ç –ø–æ —Å—Å—ã–ª–∫–∞–º</button>
                            <button onclick="this.closest('.modal').remove()">–ó–∞–∫—Ä—ã—Ç—å</button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            modal.style.display = 'block';

            this.renderLinkManagementPanel();

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–∏—Å–∫–∞
            const searchInput = modal.querySelector('#linkSearchInput');
            searchInput.addEventListener('input', () => {
                this.filterRelatedItems(searchInput.value);
            });
        };

        // –†–µ–Ω–¥–µ—Ä –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Å—ã–ª–∫–∞–º–∏
        knowledgeManager.renderLinkManagementPanel = function() {
            this.renderIncomingLinks();
            this.renderOutgoingLinks();
        };

        // –†–µ–Ω–¥–µ—Ä –≤—Ö–æ–¥—è—â–∏—Ö —Å—Å—ã–ª–æ–∫
        knowledgeManager.renderIncomingLinks = function() {
            const container = document.getElementById('incomingLinks');
            if (!container) return;

            const incomingLinks = this.findIncomingLinks();

            if (incomingLinks.length === 0) {
                container.innerHTML = '<p style="color: #6c757d; margin: 0;">–ù–µ—Ç –≤—Ö–æ–¥—è—â–∏—Ö —Å—Å—ã–ª–æ–∫</p>';
                return;
            }

            container.innerHTML = incomingLinks.map(link => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #f0f0f0;">
                    <div>
                        <strong>${link.from.name}</strong>
                        <span style="color: #6c757d; font-size: 0.9em;"> ‚Üí ${this.currentItem.name}</span>
                    </div>
                    <button onclick="knowledgeManager.navigateToItem('${link.from.id}')" style="font-size: 0.8em;">–ü–µ—Ä–µ–π—Ç–∏</button>
                </div>
            `).join('');
        };

        // –†–µ–Ω–¥–µ—Ä –∏—Å—Ö–æ–¥—è—â–∏—Ö —Å—Å—ã–ª–æ–∫
        knowledgeManager.renderOutgoingLinks = function() {
            const container = document.getElementById('outgoingLinks');
            if (!container) return;

            if (!this.currentItem.links || this.currentItem.links.length === 0) {
                container.innerHTML = '<p style="color: #6c757d; margin: 0;">–ù–µ—Ç –∏—Å—Ö–æ–¥—è—â–∏—Ö —Å—Å—ã–ª–æ–∫</p>';
                return;
            }

            container.innerHTML = this.currentItem.links.map((link, index) => {
                const targetItem = this.findTechnologyById(link.id);
                const isBroken = !targetItem;

                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #f0f0f0;">
                        <div>
                            <strong style="color: ${isBroken ? '#dc3545' : '#007bff'};">${link.name}</strong>
                            ${isBroken ? '<span style="color: #dc3545; font-size: 0.8em;"> (—Å—Å—ã–ª–∫–∞ —Å–ª–æ–º–∞–Ω–∞)</span>' : ''}
                        </div>
                        <div>
                            ${!isBroken ? `<button onclick="knowledgeManager.navigateToItem('${link.id}')" style="font-size: 0.8em; margin-right: 5px;">–ü–µ—Ä–µ–π—Ç–∏</button>` : ''}
                            <button onclick="knowledgeManager.removeOutgoingLink(${index})" class="delete" style="font-size: 0.8em;">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                `;
            }).join('');
        };

        // –ù–∞–π—Ç–∏ –≤—Ö–æ–¥—è—â–∏–µ —Å—Å—ã–ª–∫–∏
        knowledgeManager.findIncomingLinks = function() {
            const incomingLinks = [];
            const allTech = this.getAllTechnologies();

            allTech.forEach(tech => {
                if (tech.links && tech.id !== this.currentItem.id) {
                    const hasLink = tech.links.some(link => link.id === this.currentItem.id);
                    if (hasLink) {
                        incomingLinks.push({
                            from: tech,
                            to: this.currentItem
                        });
                    }
                }
            });

            return incomingLinks;
        };

        // –£–¥–∞–ª–∏—Ç—å –∏—Å—Ö–æ–¥—è—â—É—é —Å—Å—ã–ª–∫—É
        knowledgeManager.removeOutgoingLink = function(index) {
            if (this.currentItem.links && this.currentItem.links.length > index) {
                this.currentItem.links.splice(index, 1);
                this.renderLinkManagementPanel();
                this.scheduleSave();
                uiManager.showNotification('–°—Å—ã–ª–∫–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
            }
        };

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫ —ç–ª–µ–º–µ–Ω—Ç—É
        knowledgeManager.navigateToItem = function(itemId) {
            const targetItem = this.findTechnologyById(itemId);
            if (targetItem) {
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
                document.querySelectorAll('.modal').forEach(modal => modal.remove());

                // –ù–∞—Ö–æ–¥–∏–º –ø—É—Ç—å –∫ —ç–ª–µ–º–µ–Ω—Ç—É –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ
                const path = this.findPathToTechnology(targetItem);
                if (path) {
                    setTimeout(() => {
                        this.openKnowledgeBase(JSON.stringify(path.path), path.index);
                    }, 100);
                }
            }
        };

        // –ù–∞–π—Ç–∏ –ø—É—Ç—å –∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
        knowledgeManager.findPathToTechnology = function(targetTech) {
            function findPath(nodes, currentPath = []) {
                for (let i = 0; i < nodes.length; i++) {
                    const node = nodes[i];
                    if (node.id === targetTech.id) {
                        return { path: currentPath, index: i };
                    }

                    if (node.children) {
                        const result = findPath(node.children, [...currentPath, i]);
                        if (result) return result;
                    }
                }
                return null;
            }

            return findPath(techData.categories);
        };

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–æ–∫
        knowledgeManager.validateLinks = function() {
            let brokenLinks = 0;
            const allTech = this.getAllTechnologies();

            allTech.forEach(tech => {
                if (tech.links) {
                    tech.links.forEach(link => {
                        const targetExists = allTech.some(t => t.id === link.id);
                        if (!targetExists) {
                            brokenLinks++;
                            console.warn(`Broken link in ${tech.name}: ${link.name} (${link.id})`);
                        }
                    });
                }
            });

            if (brokenLinks === 0) {
                uiManager.showNotification('–í—Å–µ —Å—Å—ã–ª–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã', 'success');
            } else {
                uiManager.showNotification(`–ù–∞–π–¥–µ–Ω–æ ${brokenLinks} —Å–ª–æ–º–∞–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫`, 'warning');
            }
        };

        knowledgeManager.filterLinks = function() {
            const query = document.getElementById('linkSearch').value.toLowerCase();
            const linkItems = document.querySelectorAll('.link-item');

            linkItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(query) ? 'flex' : 'none';
            });
        };

        // –î–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Å—ã–ª–∫–∏
        knowledgeManager.showInternalLinkDialog = function() {
            const technologies = this.getAllTechnologies();
            if (technologies.length === 0) {
                uiManager.showNotification('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –¥–ª—è —Å—Å—ã–ª–∫–∏', 'warning');
                return;
            }

            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—ã–±–æ—Ä–∞
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é –¥–ª—è —Å—Å—ã–ª–∫–∏</h3>
                        <button onclick="this.closest('.modal').remove()">‚úï</button>
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <input type="text" id="internalLinkSearch" placeholder="–ü–æ–∏—Å–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π..." style="width: 100%; margin-bottom: 10px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <div id="internalLinkList" style="border: 1px solid #eee; border-radius: 4px; max-height: 300px; overflow-y: auto;">
                            ${technologies.map(tech => `
                                <div class="link-item" onclick="knowledgeManager.insertInternalLink('${tech.id}', '${tech.name}')" style="cursor: pointer; padding: 10px; border-bottom: 1px solid #f0f0f0; hover: background: #f8f9fa;">
                                    <strong>${tech.name}</strong>
                                    ${tech.content ? `<br><small style="color: #666;">${tech.content.replace(/<[^>]*>/g, '').substring(0, 50)}...</small>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            modal.style.display = 'block';

            // –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞
            const searchInput = modal.querySelector('#internalLinkSearch');
            const linkList = modal.querySelector('#internalLinkList');

            searchInput.addEventListener('input', () => {
                const query = searchInput.value.toLowerCase();
                const items = linkList.querySelectorAll('.link-item');
                items.forEach(item => {
                    item.style.display = item.textContent.toLowerCase().includes(query) ? 'block' : 'none';
                });
            });
        };

        // –í—Å—Ç–∞–≤–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Å—ã–ª–∫–∏
        knowledgeManager.insertInternalLink = function(techId, techName) {
            const linkHtml = `<a href="#" class="internal-link" data-target="${techId}">${techName}</a>`;
            knowledgeEditor.insertHtml(linkHtml);

            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.querySelectorAll('.modal').forEach(modal => {
                if (modal.innerHTML.includes('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é –¥–ª—è —Å—Å—ã–ª–∫–∏')) {
                    modal.remove();
                }
            });
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            authManager.loadAuth();
            dataManager.loadFromLocalStorage();
            accordionManager.init();
            authManager.updateSyncStatus();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω—ã—Ö —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            knowledgeEditor.initKeyboardShortcuts();
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                uiManager.hideModals();
            }
        };
    </script>
</body>
</html>
