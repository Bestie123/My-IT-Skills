<!DOCTYPE html>
<html lang="ru" data-module-id="MODULE_TechKnowledgeBase_VER_1.0">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Knowledge Base - PromAi Standard</title>
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏ - —Å–º. test1.html */
        /* –ó–¥–µ—Å—å —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ */
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        /* ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏–∑ test1.html ... */
    </style>
</head>
<body>
    <div class="container" data-module-id="MODULE_UIManager_VER_1.0" data-component-id="COMP_MainContainer">
        <h1>üìö Tech Knowledge Base - PromAi Standard</h1>
        
        <!-- Auth Section -->
        <div class="auth-section" id="authSection" data-module-id="MODULE_AuthManager_VER_1.0" data-component-id="COMP_AuthSection">
            <h3>üîê GitHub Access</h3>
            <div>
                <input type="password" id="githubToken" placeholder="GitHub Token" data-function-id="FUNC_saveAuth_002">
                <input type="text" id="repoOwner" placeholder="Owner" data-function-id="FUNC_saveAuth_002">
                <input type="text" id="repoName" placeholder="Repo" data-function-id="FUNC_saveAuth_002">
                <button onclick="authManager.saveAuth()" data-function-id="FUNC_saveAuth_002">üíæ Save</button>
                <button onclick="authManager.testAuth()" data-function-id="FUNC_testAuth_001">üîç Test</button>
            </div>
            <div id="syncStatus" class="sync-status" data-component-id="COMP_SyncStatus"></div>
            <div id="authStatus" class="auth-status" data-component-id="COMP_AuthStatus"></div>
        </div>

        <!-- Controls -->
        <div class="controls" data-module-id="MODULE_UIManager_VER_1.0" data-component-id="COMP_Controls">
            <button onclick="uiManager.showModal('categoryModal')" data-function-id="FUNC_showModal_001">+ Category</button>
            <button onclick="dataManager.exportToJSON()" data-function-id="FUNC_exportToJSON_006">üì• Export</button>
            <button onclick="knowledgeManager.showGlobalSearch()" data-function-id="FUNC_performSearch_004">üîç Search</button>
        </div>

        <!-- Accordion Container -->
        <div id="accordionContainer" class="accordion-container" data-module-id="MODULE_AccordionManager_VER_1.0" data-component-id="COMP_AccordionContainer">
            <div id="accordion" class="accordion" data-function-id="FUNC_renderAccordion_001"></div>
        </div>
    </div>

    <script>
        // === MODULE_DataManager_VER_1.0 ===
        const dataManager = {
            moduleId: 'MODULE_DataManager_VER_1.0',
            version: '1.0',
            
            // FUNC_getNodeByPath_001
            getNodeByPath(path) {
                const funcId = 'FUNC_getNodeByPath_001';
                console.log(`[${this.moduleId}][${funcId}] Getting node by path:`, path);
                
                let currentNode = techData.categories;
                for (const index of path) {
                    if (currentNode[index]) {
                        currentNode = currentNode[index].children || [];
                    } else {
                        return null;
                    }
                }
                return currentNode;
            },

            // FUNC_saveToLocalStorage_002
            saveToLocalStorage() {
                const funcId = 'FUNC_saveToLocalStorage_002';
                console.log(`[${this.moduleId}][${funcId}] Saving to localStorage`);
                
                try {
                    localStorage.setItem('techData', JSON.stringify(techData));
                    return true;
                } catch (error) {
                    console.error(`[${this.moduleId}][${funcId}] Error:`, error);
                    return false;
                }
            },

            // FUNC_addCategory_003
            addCategory() {
                const funcId = 'FUNC_addCategory_003';
                const name = document.getElementById('newCategoryName').value.trim();
                
                console.log(`[${this.moduleId}][${funcId}] Adding category:`, name);
                
                if (name) {
                    techData.categories.push({
                        id: 'cat_' + Date.now(),
                        name: name,
                        type: 'category',
                        children: []
                    });
                    this.renderCurrentView();
                    this.saveToLocalStorage();
                    uiManager.hideModals();
                    uiManager.showNotification('Category added!', 'success');
                    authManager.scheduleAutoSave();
                } else {
                    uiManager.showNotification('Enter category name!', 'error');
                }
            },

            renderCurrentView() {
                accordionManager.renderAccordion();
            }
        };

        // === MODULE_UIManager_VER_1.0 ===
        const uiManager = {
            moduleId: 'MODULE_UIManager_VER_1.0',
            version: '1.0',

            // FUNC_showModal_001
            showModal(modalId) {
                const funcId = 'FUNC_showModal_001';
                console.log(`[${this.moduleId}][${funcId}] Showing modal:`, modalId);
                
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'block';
                    modal.setAttribute('data-function-id', funcId);
                }
            },

            // FUNC_hideModals_002
            hideModals() {
                const funcId = 'FUNC_hideModals_002';
                console.log(`[${this.moduleId}][${funcId}] Hiding all modals`);
                
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            },

            // FUNC_showNotification_003
            showNotification(message, type) {
                const funcId = 'FUNC_showNotification_003';
                console.log(`[${this.moduleId}][${funcId}] Notification:`, message, type);
                
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                notification.setAttribute('data-module-id', this.moduleId);
                notification.setAttribute('data-function-id', funcId);
                document.body.appendChild(notification);
                
                setTimeout(() => notification.remove(), 3000);
            }
        };

        // === MODULE_AccordionManager_VER_1.0 ===
        const accordionManager = {
            moduleId: 'MODULE_AccordionManager_VER_1.0',
            version: '1.0',
            dependencies: ['MODULE_DataManager_VER_1.0'],

            // FUNC_renderAccordion_001
            renderAccordion() {
                const funcId = 'FUNC_renderAccordion_001';
                console.log(`[${this.moduleId}][${funcId}] Rendering accordion`);
                
                const container = document.getElementById('accordion');
                if (!container) return;
                
                container.innerHTML = '';
                container.setAttribute('data-module-id', this.moduleId);
                container.setAttribute('data-function-id', funcId);
                
                if (techData.categories.length === 0) {
                    container.innerHTML = '<p>No data. Add first category!</p>';
                    return;
                }
                
                this.buildAccordion(techData.categories, container, []);
            },

            // FUNC_buildAccordion_002
            buildAccordion(nodes, parentElement, path) {
                const funcId = 'FUNC_buildAccordion_002';
                
                nodes.forEach((node, index) => {
                    const item = document.createElement('div');
                    item.className = 'accordion-item';
                    item.setAttribute('data-module-id', this.moduleId);
                    item.setAttribute('data-function-id', funcId);
                    item.setAttribute('data-node-id', node.id || `node_${index}`);
                    
                    const header = document.createElement('div');
                    header.className = 'accordion-header';
                    header.innerHTML = `<span>${node.name}</span>`;
                    
                    item.appendChild(header);
                    parentElement.appendChild(item);
                });
            }
        };

        // === MODULE_AuthManager_VER_1.0 ===
        const authManager = {
            moduleId: 'MODULE_AuthManager_VER_1.0',
            version: '1.0',
            dependencies: ['MODULE_DataManager_VER_1.0', 'MODULE_UIManager_VER_1.0'],

            // FUNC_testAuth_001
            async testAuth() {
                const funcId = 'FUNC_testAuth_001';
                console.log(`[${this.moduleId}][${funcId}] Testing auth`);
                
                const token = document.getElementById('githubToken').value;
                const owner = document.getElementById('repoOwner').value;
                const repo = document.getElementById('repoName').value;
                
                if (!token || !owner || !repo) {
                    uiManager.showNotification('Fill all fields!', 'error');
                    return;
                }
                
                try {
                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (response.status === 200) {
                        uiManager.showNotification('‚úÖ Connection successful!', 'success');
                    } else {
                        uiManager.showNotification('‚ùå Connection failed', 'error');
                    }
                } catch (error) {
                    console.error(`[${this.moduleId}][${funcId}] Error:`, error);
                    uiManager.showNotification('‚ùå Network error', 'error');
                }
            },

            // FUNC_saveAuth_002
            saveAuth() {
                const funcId = 'FUNC_saveAuth_002';
                console.log(`[${this.moduleId}][${funcId}] Saving auth`);
                
                const token = document.getElementById('githubToken').value;
                const owner = document.getElementById('repoOwner').value;
                const repo = document.getElementById('repoName').value;
                
                if (token && owner && repo) {
                    localStorage.setItem('githubToken', token);
                    localStorage.setItem('repoOwner', owner);
                    localStorage.setItem('repoName', repo);
                    uiManager.showNotification('Settings saved!', 'success');
                }
            },

            scheduleAutoSave() {
                console.log(`[${this.moduleId}] Auto-save scheduled`);
            }
        };

        // === MODULE_KnowledgeManager_VER_1.0 ===
        const knowledgeManager = {
            moduleId: 'MODULE_KnowledgeManager_VER_1.0',
            version: '1.0',
            dependencies: ['MODULE_DataManager_VER_1.0', 'MODULE_UIManager_VER_1.0'],

            // FUNC_performSearch_004
            showGlobalSearch() {
                const funcId = 'FUNC_performSearch_004';
                console.log(`[${this.moduleId}][${funcId}] Opening search`);
                uiManager.showNotification('Search feature coming soon!', 'warning');
            }
        };

        // Global data structure
        const techData = {
            categories: []
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[PROJECT_TechKnowledgeBase] Initializing...');
            
            // Load data
            const saved = localStorage.getItem('techData');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    techData.categories = parsed.categories || [];
                } catch (e) {
                    console.error('Error loading data:', e);
                }
            }
            
            // Render
            accordionManager.renderAccordion();
            
            console.log('[PROJECT_TechKnowledgeBase] Initialized successfully');
        });
    </script>
</body>
</html>
