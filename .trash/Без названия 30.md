Документация по явным операциям соединения в SQL

<div class="toc">
<h2>Содержание</h2>
<ul>
<li><a href="#introduction">Введение в соединения SQL</a></li>
<li><a href="#inner-join">INNER JOIN</a></li>
<li><a href="#left-join">LEFT JOIN</a></li>
<li><a href="#right-join">RIGHT JOIN</a></li>
<li><a href="#full-join">FULL OUTER JOIN</a></li>
<li><a href="#cross-join">CROSS JOIN</a></li>
<li><a href="#self-join">SELF JOIN</a></li>
<li><a href="#multiple-joins">Множественные соединения</a></li>
<li><a href="#join-with-where">JOIN с условиями WHERE</a></li>
<li><a href="#performance">Производительность соединений</a></li>
<li><a href="#best-practices">Лучшие практики</a></li>
</ul>
</div>


<a name="introduction"></a>

Введение в соединения SQL

<p>Явные операции соединения в SQL позволяют объединять данные из двух или более таблиц на основе логической связи между ними. В отличие от неявных соединений (через WHERE), явные соединения используют ключевое слово JOIN, что делает запрос более читаемым и соответствует стандартам SQL.</p>

<p>Основные типы соединений:</p>

<table border="1" cellpadding="5" cellspacing="0">
<thead>
<tr>
<th>Тип соединения</th>
<th>Описание</th>
<th>Синтаксис</th>
</tr>
</thead>
<tbody>
<tr>
<td>INNER JOIN</td>
<td>Возвращает только совпадающие строки</td>
<td>SELECT ... FROM table1 INNER JOIN table2 ON условие</td>
</tr>
<tr>
<td>LEFT JOIN</td>
<td>Все строки из левой таблицы + совпадающие из правой</td>
<td>SELECT ... FROM table1 LEFT JOIN table2 ON условие</td>
</tr>
<tr>
<td>RIGHT JOIN</td>
<td>Все строки из правой таблицы + совпадающие из левой</td>
<td>SELECT ... FROM table1 RIGHT JOIN table2 ON условие</td>
</tr>
<tr>
<td>FULL JOIN</td>
<td>Все строки из обеих таблиц</td>
<td>SELECT ... FROM table1 FULL JOIN table2 ON условие</td>
</tr>
<tr>
<td>CROSS JOIN</td>
<td>Декартово произведение всех строк</td>
<td>SELECT ... FROM table1 CROSS JOIN table2</td>
</tr>
</tbody>
</table>

<a name="inner-join"></a>

INNER JOIN

<p>INNER JOIN возвращает только те строки, для которых условие соединения выполняется в обеих таблицах. Это самый распространенный тип соединения.</p>

```sql
-- Базовый синтаксис INNER JOIN
SELECT столбцы
FROM таблица1
INNER JOIN таблица2 ON таблица1.столбец = таблица2.столбец;
```

<p><strong>Пример с объяснением для новичков:</strong></p>

```sql
-- Создаем демонстрационные таблицы
CREATE TABLE employees (
    id INT PRIMARY KEY,
    name VARCHAR(50),
    department_id INT
);

CREATE TABLE departments (
    id INT PRIMARY KEY,
    department_name VARCHAR(50)
);

-- Вставляем тестовые данные
INSERT INTO employees VALUES 
(1, 'Иван Иванов', 1),
(2, 'Петр Петров', 1),
(3, 'Мария Сидорова', 2),
(4, 'Анна Козлова', 3),
(5, 'Сергей Смирнов', NULL);

INSERT INTO departments VALUES 
(1, 'IT'),
(2, 'HR'),
(3, 'Финансы'),
(4, 'Маркетинг');

-- INNER JOIN пример
SELECT 
    e.name AS employee_name,
    d.department_name
FROM employees e
INNER JOIN departments d ON e.department_id = d.id;
```

<p><strong>Объяснение:</strong></p>
<ul>
<li><code>INNER JOIN departments d ON e.department_id = d.id</code> - соединяем таблицы по полю department_id</li>
<li>Возвращаются только сотрудники, у которых есть отдел в таблице departments</li>
<li>Сотрудник "Сергей Смирнов" не будет включен в результат (department_id = NULL)</li>
<li>Отдел "Маркетинг" не будет включен (нет сотрудников в этом отделе)</li>
</ul>

<table border="1" cellpadding="5" cellspacing="0">
<thead>
<tr>
<th>employee_name</th>
<th>department_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Иван Иванов</td>
<td>IT</td>
</tr>
<tr>
<td>Петр Петров</td>
<td>IT</td>
</tr>
<tr>
<td>Мария Сидорова</td>
<td>HR</td>
</tr>
<tr>
<td>Анна Козлова</td>
<td>Финансы</td>
</tr>
</tbody>
</table>

<a name="left-join"></a>

LEFT JOIN

<p>LEFT JOIN возвращает все строки из левой таблицы (первой в запросе) и соответствующие строки из правой таблицы. Если соответствия нет, возвращается NULL для столбцов правой таблицы.</p>

```sql
-- Базовый синтаксис LEFT JOIN
SELECT столбцы
FROM таблица1
LEFT JOIN таблица2 ON таблица1.столбец = таблица2.столбец;
```

<p><strong>Пример с объяснением для новичков:</strong></p>

```sql
-- LEFT JOIN пример
SELECT 
    e.name AS employee_name,
    d.department_name
FROM employees e
LEFT JOIN departments d ON e.department_id = d.id;
```

<p><strong>Объяснение:</strong></p>
<ul>
<li>Все сотрудники из таблицы employees будут в результате</li>
<li>Для сотрудника "Сергей Смирнов" department_name будет NULL</li>
<li>Отдел "Маркетинг" не будет показан (нет в левой таблице)</li>
</ul>

<table border="1" cellpadding="5" cellspacing="0">
<thead>
<tr>
<th>employee_name</th>
<th>department_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Иван Иванов</td>
<td>IT</td>
</tr>
<tr>
<td>Петр Петров</td>
<td>IT</td>
</tr>
<tr>
<td>Мария Сидорова</td>
<td>HR</td>
</tr>
<tr>
<td>Анна Козлова</td>
<td>Финансы</td>
</tr>
<tr>
<td>Сергей Смирнов</td>
<td>NULL</td>
</tr>
</tbody>
</table>

<a name="right-join"></a>

RIGHT JOIN

<p>RIGHT JOIN возвращает все строки из правой таблицы и соответствующие строки из левой таблицы. Если соответствия нет, возвращается NULL для столбцов левой таблицы.</p>

```sql
-- Базовый синтаксис RIGHT JOIN
SELECT столбцы
FROM таблица1
RIGHT JOIN таблица2 ON таблица1.столбец = таблица2.столбец;
```

<p><strong>Пример с объяснением для новичков:</strong></p>

```sql
-- RIGHT JOIN пример
SELECT 
    e.name AS employee_name,
    d.department_name
FROM employees e
RIGHT JOIN departments d ON e.department_id = d.id;
```

<p><strong>Объяснение:</strong></p>
<ul>
<li>Все отделы из таблицы departments будут в результате</li>
<li>Для отдела "Маркетинг" employee_name будет NULL</li>
<li>Сотрудник "Сергей Смирнов" не будет показан (department_id = NULL)</li>
</ul>

<table border="1" cellpadding="5" cellspacing="0">
<thead>
<tr>
<th>employee_name</th>
<th>department_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Иван Иванов</td>
<td>IT</td>
</tr>
<tr>
<td>Петр Петров</td>
<td>IT</td>
</tr>
<tr>
<td>Мария Сидорова</td>
<td>HR</td>
</tr>
<tr>
<td>Анна Козлова</td>
<td>Финансы</td>
</tr>
<tr>
<td>NULL</td>
<td>Маркетинг</td>
</tr>
</tbody>
</table>

<a name="full-join"></a>

FULL OUTER JOIN

<p>FULL OUTER JOIN возвращает все строки из обеих таблиц. Если нет соответствия, для недостающих данных возвращается NULL.</p>

```sql
-- Базовый синтаксис FULL OUTER JOIN
SELECT столбцы
FROM таблица1
FULL OUTER JOIN таблица2 ON таблица1.столбец = таблица2.столбец;
```

<p><strong>Пример с объяснением для новичков:</strong></p>

```sql
-- FULL OUTER JOIN пример (работает в PostgreSQL, SQL Server)
SELECT 
    e.name AS employee_name,
    d.department_name
FROM employees e
FULL OUTER JOIN departments d ON e.department_id = d.id;
```

<p><strong>Объяснение:</strong></p>
<ul>
<li>Включает всех сотрудников и все отделы</li>
<li>Сотрудник без отдела и отдел без сотрудников будут показаны с NULL</li>
</ul>

<table border="1" cellpadding="5" cellspacing="0">
<thead>
<tr>
<th>employee_name</th>
<th>department_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Иван Иванов</td>
<td>IT</td>
</tr>
<tr>
<td>Петр Петров</td>
<td>IT</td>
</tr>
<tr>
<td>Мария Сидорова</td>
<td>HR</td>
</tr>
<tr>
<td>Анна Козлова</td>
<td>Финансы</td>
</tr>
<tr>
<td>Сергей Смирнов</td>
<td>NULL</td>
</tr>
<tr>
<td>NULL</td>
<td>Маркетинг</td>
</tr>
</tbody>
</table>

<a name="cross-join"></a>

CROSS JOIN

<p>CROSS JOIN возвращает декартово произведение строк из обеих таблиц - каждая строка первой таблицы соединяется с каждой строкой второй таблицы.</p>

```sql
-- Базовый синтаксис CROSS JOIN
SELECT столбцы
FROM таблица1
CROSS JOIN таблица2;
```

<p><strong>Пример с объяснением для новичков:</strong></p>

```sql
-- CROSS JOIN пример
SELECT 
    e.name AS employee_name,
    d.department_name
FROM employees e
CROSS JOIN departments d;
```

<p><strong>Объяснение:</strong></strong></p>
<ul>
<li>Каждый сотрудник будет соединен с каждым отделом</li>
<li>Количество строк = количество сотрудников × количество отделов</li>
<li>Полезно для создания всех возможных комбинаций</li>
</ul>

<a name="self-join"></a>

SELF JOIN

<p>SELF JOIN - это соединение таблицы с самой собой. Используется, когда данные в одной таблице ссылаются на другие данные в той же таблице.</p>

```sql
-- Базовый синтаксис SELF JOIN
SELECT a.столбцы, b.столбцы
FROM таблица a
JOIN таблица b ON a.столбец = b.столбец;
```

<p><strong>Пример с объяснением для новичков:</strong></p>

```sql
-- Создаем таблицу сотрудников с менеджерами
CREATE TABLE employees_hierarchy (
    id INT PRIMARY KEY,
    name VARCHAR(50),
    manager_id INT
);

INSERT INTO employees_hierarchy VALUES 
(1, 'Директор', NULL),
(2, 'Менеджер IT', 1),
(3, 'Менеджер HR', 1),
(4, 'Разработчик', 2),
(5, 'Тестировщик', 2),
(6, 'Рекрутер', 3);

-- SELF JOIN для получения сотрудников с их менеджерами
SELECT 
    e.name AS employee_name,
    m.name AS manager_name
FROM employees_hierarchy e
LEFT JOIN employees_hierarchy m ON e.manager_id = m.id;
```

<table border="1" cellpadding="5" cellspacing="0">
<thead>
<tr>
<th>employee_name</th>
<th>manager_name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Директор</td>
<td>NULL</td>
</tr>
<tr>
<td>Менеджер IT</td>
<td>Директор</td>
</tr>
<tr>
<td>Менеджер HR</td>
<td>Директор</td>
</tr>
<tr>
<td>Разработчик</td>
<td>Менеджер IT</td>
</tr>
<tr>
<td>Тестировщик</td>
<td>Менеджер IT</td>
</tr>
<tr>
<td>Рекрутер</td>
<td>Менеджер HR</td>
</tr>
</tbody>
</table>

<a name="multiple-joins"></a>

Множественные соединения

<p>В SQL можно соединять более двух таблиц в одном запросе. Порядок соединений важен для правильного формирования результата.</p>

```sql
-- Синтаксис множественных JOIN
SELECT столбцы
FROM таблица1
JOIN таблица2 ON условие1
JOIN таблица3 ON условие2
...
```

<p><strong>Пример с объяснением для новичков:</strong></p>

```sql
-- Создаем дополнительные таблицы для демонстрации
CREATE TABLE projects (
    id INT PRIMARY KEY,
    project_name VARCHAR(50),
    department_id INT
);

INSERT INTO projects VALUES 
(1, 'Веб-сайт', 1),
(2, 'Мобильное приложение', 1),
(3, 'Подбор персонала', 2);

CREATE TABLE employee_projects (
    employee_id INT,
    project_id INT,
    role VARCHAR(50)
);

INSERT INTO employee_projects VALUES 
(1, 1, 'Разработчик'),
(1, 2, 'Архитектор'),
(2, 1, 'Тестировщик'),
(3, 3, 'Рекрутер'),
(4, 2, 'Аналитик');

-- Множественные JOIN
SELECT 
    e.name AS employee_name,
    d.department_name,
    p.project_name,
    ep.role
FROM employees e
INNER JOIN departments d ON e.department_id = d.id
INNER JOIN employee_projects ep ON e.id = ep.employee_id
INNER JOIN projects p ON ep.project_id = p.id;
```

<table border="1" cellpadding="5" cellspacing="0">
<thead>
<tr>
<th>employee_name</th>
<th>department_name</th>
<th>project_name</th>
<th>role</th>
</tr>
</thead>
<tbody>
<tr>
<td>Иван Иванов</td>
<td>IT</td>
<td>Веб-сайт</td>
<td>Разработчик</td>
</tr>
<tr>
<td>Иван Иванов</td>
<td>IT</td>
<td>Мобильное приложение</td>
<td>Архитектор</td>
</tr>
<tr>
<td>Петр Петров</td>
<td>IT</td>
<td>Веб-сайт</td>
<td>Тестировщик</td>
</tr>
<tr>
<td>Мария Сидорова</td>
<td>HR</td>
<td>Подбор персонала</td>
<td>Рекрутер</td>
</tr>
<tr>
<td>Анна Козлова</td>
<td>Финансы</td>
<td>Мобильное приложение</td>
<td>Аналитик</td>
</tr>
</tbody>
</table>

<a name="join-with-where"></a>

JOIN с условиями WHERE

<p>Условия WHERE можно комбинировать с JOIN для дополнительной фильтрации результатов.</p>

```sql
-- JOIN с WHERE
SELECT столбцы
FROM таблица1
JOIN таблица2 ON условие_соединения
WHERE условие_фильтрации;
```

<p><strong>Пример с объяснением для новичков:</strong></p>

```sql
-- LEFT JOIN с WHERE для поиска сотрудников без отделов
SELECT 
    e.name AS employee_name
FROM employees e
LEFT JOIN departments d ON e.department_id = d.id
WHERE d.id IS NULL;

-- INNER JOIN с дополнительными условиями
SELECT 
    e.name AS employee_name,
    d.department_name
FROM employees e
INNER JOIN departments d ON e.department_id = d.id
WHERE d.department_name = 'IT'
ORDER BY e.name;
```

<a name="performance"></a>

Производительность соединений

<p>Для оптимизации производительности JOIN следует учитывать следующие факторы:</p>

<table border="1" cellpadding="5" cellspacing="0">
<thead>
<tr>
<th>Фактор</th>
<th>Влияние на производительность</th>
<th>Рекомендации</th>
</tr>
</thead>
<tbody>
<tr>
<td>Индексы</td>
<td>Критически важны</td>
<td>Создавайте индексы на столбцах соединения</td>
</tr>
<tr>
<td>Размер таблиц</td>
<td>Прямое влияние</td>
<td>Сначала соединяйте маленькие таблицы</td>
</tr>
<tr>
<td>Тип соединения</td>
<td>INNER JOIN обычно быстрее</td>
<td>Используйте минимально необходимый тип JOIN</td>
</tr>
<tr>
<td>Условия WHERE</td>
<td>Могут ускорить запрос</td>
<td>Фильтруйте данные как можно раньше</td>
</tr>
</tbody>
</table>

```sql
-- Пример создания индексов для оптимизации JOIN
CREATE INDEX idx_employees_department_id ON employees(department_id);
CREATE INDEX idx_departments_id ON departments(id);
CREATE INDEX idx_employee_projects_employee_id ON employee_projects(employee_id);
CREATE INDEX idx_employee_projects_project_id ON employee_projects(project_id);
```

<a name="best-practices"></a>

Лучшие практики

<p>Следующие рекомендации помогут писать эффективные и поддерживаемые запросы с JOIN:</p>

```sql
-- ✅ ПРАВИЛЬНО: Использование псевдонимов
SELECT 
    e.name,
    d.department_name
FROM employees e
INNER JOIN departments d ON e.department_id = d.id;

-- ✅ ПРАВИЛЬНО: Явное указание INNER JOIN
SELECT 
    e.name,
    d.department_name
FROM employees e
INNER JOIN departments d ON e.department_id = d.id;

-- ❌ НЕПРАВИЛЬНО: Неявное соединение (устаревший синтаксис)
SELECT 
    e.name,
    d.department_name
FROM employees e, departments d
WHERE e.department_id = d.id;
```

<table border="1" cellpadding="5" cellspacing="0">
<thead>
<tr>
<th>Практика</th>
<th>Преимущества</th>
<th>Пример</th>
</tr>
</thead>
<tbody>
<tr>
<td>Используйте псевдонимы</td>
<td>Улучшает читаемость</td>
<td>FROM employees e JOIN departments d</td>
</tr>
<tr>
<td>Явные JOIN вместо неявных</td>
<td>Современный стандарт, лучше читаемость</td>
<td>INNER JOIN вместо WHERE</td>
</tr>
<tr>
<td>Порядок соединений</td>
<td>Может влиять на производительность</td>
<td>Сначала маленькие таблицы</td>
</tr>
<tr>
<td>Используйте INNER JOIN явно</td>
<td>Ясность намерений</td>
<td>INNER JOIN вместо просто JOIN</td>
</tr>
<tr>
<td>Проверяйте на NULL</td>
<td>Избегайте неожиданных результатов</td>
<td>WHERE column IS NOT NULL</td>
</tr>
</tbody>
</table>

```sql
-- Пример хорошего запроса с несколькими JOIN
SELECT 
    e.name AS employee_name,
    d.department_name,
    p.project_name,
    ep.role,
    m.name AS manager_name
FROM employees e
INNER JOIN departments d ON e.department_id = d.id
LEFT JOIN employee_projects ep ON e.id = ep.employee_id
LEFT JOIN projects p ON ep.project_id = p.id
LEFT JOIN employees_hierarchy eh ON e.id = eh.id
LEFT JOIN employees_hierarchy m ON eh.manager_id = m.id
WHERE e.department_id IS NOT NULL
ORDER BY d.department_name, e.name;
```

<div class="navigation">
<hr>
<p><strong>Навигация по документации:</strong></p>
<ul>
<li><a href="#introduction">Введение в соединения SQL</a></li>
<li><a href="#inner-join">INNER JOIN</a></li>
<li><a href="#left-join">LEFT JOIN</a></li>
<li><a href="#right-join">RIGHT JOIN</a></li>
<li><a href="#full-join">FULL OUTER JOIN</a></li>
<li><a href="#cross-join">CROSS JOIN</a></li>
<li><a href="#self-join">SELF JOIN</a></li>
<li><a href="#multiple-joins">Множественные соединения</a></li>
<li><a href="#join-with-where">JOIN с условиями WHERE</a></li>
<li><a href="#performance">Производительность соединений</a></li>
<li><a href="#best-practices">Лучшие практики</a></li>
</ul>
</div>