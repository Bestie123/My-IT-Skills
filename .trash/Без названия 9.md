Документация по явным операциям соединения в SQL

```markdown
# Явные операции соединения в SQL

## Содержание
- [[#Введение]]
- [[#Типы JOIN операций]]
- [[#Синтаксис]]
- [[#Примеры таблиц]]
- [[#Детальное описание каждого JOIN]]
- [[#Особенности производительности]]
- [[#Лучшие практики]]
- [[#Связанные темы]]

## Введение

Явные операции соединения (explicit JOIN) в SQL используются для объединения данных из двух или более таблиц на основе логического условия. В отличие от неявных соединений (через WHERE), явные JOIN более читаемы и соответствуют современным стандартам SQL.

## Типы JOIN операций

<table border="1">
  <tr>
    <th>Тип JOIN</th>
    <th>Описание</th>
    <th>Результат</th>
  </tr>
  <tr>
    <td><code>INNER JOIN</code></td>
    <td>Возвращает только совпадающие строки из обеих таблиц</td>
    <td>Пересечение</td>
  </tr>
  <tr>
    <td><code>LEFT JOIN</code></td>
    <td>Возвращает все строки из левой таблицы и совпадающие из правой</td>
    <td>Вся левая + пересечение</td>
  </tr>
  <tr>
    <td><code>RIGHT JOIN</code></td>
    <td>Возвращает все строки из правой таблицы и совпадающие из левой</td>
    <td>Вся правая + пересечение</td>
  </tr>
  <tr>
    <td><code>FULL JOIN</code></td>
    <td>Возвращает все строки из обеих таблиц</td>
    <td>Объединение</td>
  </tr>
  <tr>
    <td><code>CROSS JOIN</code></td>
    <td>Возвращает декартово произведение таблиц</td>
    <td>Все комбинации</td>
  </tr>
</table>

## Синтаксис

```sql
SELECT columns
FROM table1
JOIN_TYPE table2 ON table1.column = table2.column
[WHERE conditions]
[ORDER BY columns];
```

Примеры таблиц

Для демонстрации будем использовать следующие таблицы:

Таблица Employees

<table border="1">
  <tr>
    <th>employee_id</th>
    <th>name</th>
    <th>department_id</th>
    <th>salary</th>
  </tr>
  <tr>
    <td>1</td>
    <td>Иван Иванов</td>
    <td>101</td>
    <td>50000</td>
  </tr>
  <tr>
    <td>2</td>
    <td>Петр Петров</td>
    <td>102</td>
    <td>60000</td>
  </tr>
  <tr>
    <td>3</td>
    <td>Мария Сидорова</td>
    <td>101</td>
    <td>55000</td>
  </tr>
  <tr>
    <td>4</td>
    <td>Анна Козлова</td>
    <td>NULL</td>
    <td>45000</td>
  </tr>
</table>

Таблица Departments

<table border="1">
  <tr>
    <th>department_id</th>
    <th>department_name</th>
    <th>manager_id</th>
  </tr>
  <tr>
    <td>101</td>
    <td>IT</td>
    <td>1</td>
  </tr>
  <tr>
    <td>102</td>
    <td>HR</td>
    <td>2</td>
  </tr>
  <tr>
    <td>103</td>
    <td>Finance</td>
    <td>NULL</td>
  </tr>
</table>

Детальное описание каждого JOIN

INNER JOIN

Возвращает только те строки, для которых условие соединения истинно в обеих таблицах.

```sql
SELECT e.name, d.department_name
FROM Employees e
INNER JOIN Departments d ON e.department_id = d.department_id;
```

Результат:

<table border="1">
  <tr>
    <th>name</th>
    <th>department_name</th>
  </tr>
  <tr>
    <td>Иван Иванов</td>
    <td>IT</td>
  </tr>
  <tr>
    <td>Петр Петров</td>
    <td>HR</td>
  </tr>
  <tr>
    <td>Мария Сидорова</td>
    <td>IT</td>
  </tr>
</table>

LEFT JOIN (LEFT OUTER JOIN)

Возвращает все строки из левой таблицы и соответствующие строки из правой таблицы. Если соответствий нет, возвращает NULL для правой таблицы.

```sql
SELECT e.name, d.department_name
FROM Employees e
LEFT JOIN Departments d ON e.department_id = d.department_id;
```

Результат:

<table border="1">
  <tr>
    <th>name</th>
    <th>department_name</th>
  </tr>
  <tr>
    <td>Иван Иванов</td>
    <td>IT</td>
  </tr>
  <tr>
    <td>Петр Петров</td>
    <td>HR</td>
  </tr>
  <tr>
    <td>Мария Сидорова</td>
    <td>IT</td>
  </tr>
  <tr>
    <td>Анна Козлова</td>
    <td>NULL</td>
  </tr>
</table>

RIGHT JOIN (RIGHT OUTER JOIN)

Возвращает все строки из правой таблицы и соответствующие строки из левой таблицы. Если соответствий нет, возвращает NULL для левой таблицы.

```sql
SELECT e.name, d.department_name
FROM Employees e
RIGHT JOIN Departments d ON e.department_id = d.department_id;
```

Результат:

<table border="1">
  <tr>
    <th>name</th>
    <th>department_name</th>
  </tr>
  <tr>
    <td>Иван Иванов</td>
    <td>IT</td>
  </tr>
  <tr>
    <td>Петр Петров</td>
    <td>HR</td>
  </tr>
  <tr>
    <td>Мария Сидорова</td>
    <td>IT</td>
  </tr>
  <tr>
    <td>NULL</td>
    <td>Finance</td>
  </tr>
</table>

FULL JOIN (FULL OUTER JOIN)

Возвращает все строки из обеих таблиц, объединяя результаты LEFT и RIGHT JOIN.

```sql
SELECT e.name, d.department_name
FROM Employees e
FULL JOIN Departments d ON e.department_id = d.department_id;
```

Результат:

<table border="1">
  <tr>
    <th>name</th>
    <th>department_name</th>
  </tr>
  <tr>
    <td>Иван Иванов</td>
    <td>IT</td>
  </tr>
  <tr>
    <td>Петр Петров</td>
    <td>HR</td>
  </tr>
  <tr>
    <td>Мария Сидорова</td>
    <td>IT</td>
  </tr>
  <tr>
    <td>Анна Козлова</td>
    <td>NULL</td>
  </tr>
  <tr>
    <td>NULL</td>
    <td>Finance</td>
  </tr>
</table>

CROSS JOIN

Возвращает декартово произведение строк из обеих таблиц (каждую строку из первой таблицы с каждой строкой из второй).

```sql
SELECT e.name, d.department_name
FROM Employees e
CROSS JOIN Departments d;
```

Результат: 4 сотрудника × 3 отдела = 12 строк

Множественные JOIN

JOIN можно использовать для соединения нескольких таблиц:

```sql
SELECT e.name, d.department_name, m.name as manager_name
FROM Employees e
INNER JOIN Departments d ON e.department_id = d.department_id
LEFT JOIN Employees m ON d.manager_id = m.employee_id;
```

JOIN с дополнительными условиями

Условия можно комбинировать с WHERE или дополнительными условиями в ON:

```sql
-- С WHERE
SELECT e.name, d.department_name
FROM Employees e
INNER JOIN Departments d ON e.department_id = d.department_id
WHERE e.salary > 50000;

-- С дополнительными условиями в ON
SELECT e.name, d.department_name
FROM Employees e
INNER JOIN Departments d ON e.department_id = d.department_id AND e.salary > 50000;
```

Особенности производительности

1. Индексы: JOIN работают значительно быстрее при наличии индексов на соединяемых колонках
2. Порядок таблиц: Для INNER JOIN порядок не важен, для OUTER JOIN - критичен
3. Селективность: Чем больше данных отфильтровывается в ON, тем лучше производительность

Лучшие практики

1. Всегда используйте явные JOIN вместо неявных (в WHERE)
2. Используйте псевдонимы таблиц для улучшения читаемости
3. Указывайте условия соединения в ON, а фильтры в WHERE
4. Для сложных запросов используйте форматирование для лучшей читаемости
5. Тестируйте запросы на небольших наборах данных перед выполнением на production

Связанные темы

· [[SQL Basics]]
· [[Подзапросы в SQL]]
· [[Индексы в SQL]]
· [[Оптимизация SQL запросов]]
· [[Оконные функции в SQL]]

---

Теги: #sql #join #database #inner-join #left-join #right-join #full-join #cross-join
Связанные:[[SQL операции соединения]] [[Базы данных]] [[Оптимизация запросов]]

```