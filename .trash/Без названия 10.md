
# Явные операции соединения в SQL

## Содержание
- [[#Введение в JOIN]]
- [[#Типы явных соединений]]
- [[#INNER JOIN]]
- [[#LEFT JOIN]]
- [[#RIGHT JOIN]]
- [[#FULL JOIN]]
- [[#CROSS JOIN]]
- [[#Синтаксис JOIN]]
- [[#Примеры соединений]]
- [[#Множественные JOIN]]
- [[#JOIN с условиями WHERE]]
- [[#Производительность JOIN]]
- [[#Лучшие практики]]

## Введение в JOIN

**Явные операции соединения** (explicit JOINs) в SQL используются для объединения данных из двух или более таблиц на основе логической связи между ними.

### Ключевые понятия
- **JOIN** - оператор объединения таблиц
- **ON** - условие соединения
- **Ключи соединения** - столбцы, по которым происходит связывание

## Типы явных соединений

<table border="1" style="border-collapse: collapse; width: 100%;">
<tr>
<th>Тип JOIN</th>
<th>Описание</th>
<th>Результат</th>
</tr>
<tr>
<td>INNER JOIN</td>
<td>Возвращает только совпадающие строки</td>
<td>Пересечение множеств</td>
</tr>
<tr>
<td>LEFT JOIN</td>
<td>Все строки левой таблицы + совпадающие правой</td>
<td>Левое внешнее соединение</td>
</tr>
<tr>
<td>RIGHT JOIN</td>
<td>Все строки правой таблицы + совпадающие левой</td>
<td>Правое внешнее соединение</td>
</tr>
<tr>
<td>FULL JOIN</td>
<td>Все строки обеих таблиц</td>
<td>Полное внешнее соединение</td>
</tr>
<tr>
<td>CROSS JOIN</td>
<td>Декартово произведение таблиц</td>
<td>Все возможные комбинации</td>
</tr>
</table>

## INNER JOIN

**INNER JOIN** возвращает только те строки, для которых условие соединения истинно в обеих таблицах.

### Синтаксис
```sql
SELECT столбцы
FROM таблица1
INNER JOIN таблица2 ON таблица1.столбец = таблица2.столбец;
```

Пример

```sql
SELECT 
    employees.name,
    departments.department_name
FROM employees
INNER JOIN departments ON employees.department_id = departments.id;
```

LEFT JOIN

LEFT JOIN возвращает все строки из левой таблицы и соответствующие строки из правой таблицы. Если соответствия нет, возвращается NULL.

Синтаксис

```sql
SELECT столбцы
FROM таблица1
LEFT JOIN таблица2 ON таблица1.столбец = таблица2.столбец;
```

Пример

```sql
SELECT 
    customers.customer_name,
    orders.order_date
FROM customers
LEFT JOIN orders ON customers.id = orders.customer_id;
```

RIGHT JOIN

RIGHT JOIN возвращает все строки из правой таблицы и соответствующие строки из левой таблицы.

Синтаксис

```sql
SELECT столбцы
FROM таблица1
RIGHT JOIN таблица2 ON таблица1.столбец = таблица2.столбец;
```

Пример

```sql
SELECT 
    products.product_name,
    categories.category_name
FROM products
RIGHT JOIN categories ON products.category_id = categories.id;
```

FULL JOIN

FULL JOIN возвращает все строки обеих таблиц, объединяя результаты LEFT и RIGHT JOIN.

Синтаксис

```sql
SELECT столбцы
FROM таблица1
FULL JOIN таблица2 ON таблица1.столбец = таблица2.столбец;
```

Пример

```sql
SELECT 
    employees.name,
    projects.project_name
FROM employees
FULL JOIN projects ON employees.id = projects.manager_id;
```

CROSS JOIN

CROSS JOIN возвращает декартово произведение строк обеих таблиц.

Синтаксис

```sql
SELECT столбцы
FROM таблица1
CROSS JOIN таблица2;
```

Пример

```sql
SELECT 
    sizes.size_name,
    colors.color_name
FROM sizes
CROSS JOIN colors;
```

Синтаксис JOIN

Базовый синтаксис

```sql
SELECT 
    t1.column1,
    t2.column2,
    ...
FROM table1 t1
[JOIN_TYPE] JOIN table2 t2 ON t1.common_column = t2.common_column
[WHERE условия];
```

Псевдонимы таблиц

```sql
SELECT 
    e.name,
    d.department_name
FROM employees e
INNER JOIN departments d ON e.department_id = d.id;
```

Примеры соединений

Пример 1: INNER JOIN с фильтрацией

```sql
SELECT 
    p.product_name,
    c.category_name,
    p.price
FROM products p
INNER JOIN categories c ON p.category_id = c.id
WHERE p.price > 100;
```

Пример 2: LEFT JOIN с проверкой на NULL

```sql
SELECT 
    c.customer_name,
    o.order_date
FROM customers c
LEFT JOIN orders o ON c.id = o.customer_id
WHERE o.customer_id IS NULL;
```

Пример 3: Множественный INNER JOIN

```sql
SELECT 
    e.first_name,
    e.last_name,
    d.department_name,
    p.project_name
FROM employees e
INNER JOIN departments d ON e.department_id = d.id
INNER JOIN projects p ON e.id = p.employee_id;
```

Множественные JOIN

Цепочка соединений

```sql
SELECT 
    o.order_id,
    c.customer_name,
    p.product_name,
    cat.category_name
FROM orders o
INNER JOIN customers c ON o.customer_id = c.id
INNER JOIN order_items oi ON o.order_id = oi.order_id
INNER JOIN products p ON oi.product_id = p.id
INNER JOIN categories cat ON p.category_id = cat.id;
```

Смешанные типы JOIN

```sql
SELECT 
    e.name,
    d.department_name,
    p.project_name
FROM employees e
LEFT JOIN departments d ON e.department_id = d.id
LEFT JOIN projects p ON e.id = p.employee_id
WHERE d.department_name = 'IT';
```

JOIN с условиями WHERE

Фильтрация результатов JOIN

```sql
SELECT 
    e.name,
    s.salary
FROM employees e
INNER JOIN salaries s ON e.id = s.employee_id
WHERE s.salary > 50000
AND e.hire_date > '2020-01-01';
```

JOIN с агрегатными функциями

```sql
SELECT 
    d.department_name,
    COUNT(e.id) as employee_count,
    AVG(s.salary) as avg_salary
FROM departments d
LEFT JOIN employees e ON d.id = e.department_id
LEFT JOIN salaries s ON e.id = s.employee_id
GROUP BY d.department_name;
```

Производительность JOIN

Индексы для JOIN

```sql
-- Создание индексов для улучшения производительности JOIN
CREATE INDEX idx_employees_department_id ON employees(department_id);
CREATE INDEX idx_departments_id ON departments(id);
```

EXPLAIN для анализа JOIN

```sql
EXPLAIN 
SELECT e.name, d.department_name
FROM employees e
INNER JOIN departments d ON e.department_id = d.id;
```

Лучшие практики

1. Используйте псевдонимы

```sql
-- Хорошо
SELECT e.name, d.department_name
FROM employees e
INNER JOIN departments d ON e.department_id = d.id;

-- Плохо
SELECT employees.name, departments.department_name
FROM employees
INNER JOIN departments ON employees.department_id = departments.id;
```

2. Явно указывайте INNER JOIN

```sql
-- Рекомендуется
SELECT ...
FROM table1
INNER JOIN table2 ON ...

-- Не рекомендуется (неявный JOIN)
SELECT ...
FROM table1, table2
WHERE table1.id = table2.id;
```

3. Используйте правильные типы JOIN

```sql
-- Для получения только совпадающих данных
SELECT ... FROM A INNER JOIN B ON ...

-- Для получения всех данных из A
SELECT ... FROM A LEFT JOIN B ON ...

-- Для получения всех данных из B
SELECT ... FROM A RIGHT JOIN B ON ...
```

4. Оптимизируйте условия ON

```sql
-- Эффективно
SELECT ... 
FROM orders o
INNER JOIN customers c ON o.customer_id = c.id
WHERE o.order_date > '2023-01-01';

-- Менее эффективно
SELECT ... 
FROM orders o
INNER JOIN customers c ON o.customer_id = c.id 
AND o.order_date > '2023-01-01';
```

---

Теги для навигации

#sql #join #database #inner-join #left-join #right-join #full-join #cross-join #sql-optimization

Связанные темы

[[SQL Basics]] [[Подзапросы в SQL]] [[Агрегатные функции SQL]] [[Индексы в базах данных]]

```